
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>KBase . Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/services/search/libs/bootstrap/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 20px;
        padding-bottom: 40px;
      }

      .kbaselogo {
        padding-left:0px;
        height:60px;
      }

      h6 { margin: 0px; }

      /* Custom container */
      .container-narrow {
        margin: 0 auto;
        max-width: 980px;
        /*max-width: 700px;*/
      }
      .container-narrow > hr {
        margin: 30px 0;
      }

      .jumbotron {
        margin: 60px 0;
        text-align: center;
      }
      .jumbotron h1 {
        font-size: 72px;
        line-height: 1;
      }

      .sideElem {
        font-size: 11px;
      }

      .highlight {
        background-color: #FFFF88;
      }


    </style>
    <link href="/services/search/libs/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/services/search/libs/bootstrap/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/services/search/libs/bootstrap/ico/apple-touch-icon-114-precomposed.png">
      <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/services/search/libs/bootstrap/ico/apple-touch-icon-72-precomposed.png">
                    <link rel="apple-touch-icon-precomposed" href="/services/search/libs/bootstrap/ico/apple-touch-icon-57-precomposed.png">
                                   <link rel="shortcut icon" href="/services/search/libs/bootstrap/ico/favicon.png">
  </head>

  <body onLoad="getGenome('<%= keyword %>')">

    <div class="container-narrow">

      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li class="active"><a href="/services/search">Search Home</a></li>
          <li><a href="http://kbase.us">KBase Home</a></li>
          <!--li><a href="#">Feedback</a></li-->
        </ul>
        <!-- <h3 class="muted"><img src="/services/search/libs/bootstrap/img/Kbase_Logo.png" class='kbaselogo'/></h3> -->
        <a href='http://kbase.us'><h3 class="muted"><img src="http://kbase.us/themes/kbase/images/Kbase_Logo.png" class='kbaselogo'/></h3></a>
      </div>

      <hr>


<script src="/services/search/libs/js/CDMI.js"></script>
<link href="/services/search/libs/css/common.css" rel="stylesheet">

<style>
  .sideElem {
    font-size: 11px;
  }
</style>

      <div class="jumbotron" style='margin:0px 0px 0px 0px;'>
        <h1>KBase Search<small><img src='/services/search/libs/imgs/beta.gif'/></small></h1>
        <dir class='row'>
          <div class="input-append">
            <form class="form-wrapper" action='/services/search/process' id='searchForm' method='post' >
              <input class="span2" id="appendedInputButtons" name='keyword' type="text" style='width:400px;'>
              <button class="btn" type="button" id='search' >Search</button>
              <button class="btn" type="button" id='advanced' >Advanced</button>
            </form>
          </div>
        </div>

        <div class='row' style='margin-left:20px; border-bottom:1px solid #ccc;padding:20px;margin-top:5px;padding-top:0px;'>

        </div>


        <div class="row" style='padding-top:15px;padding-left:5px;'>
          <div class="span8">
          
            <div class='well'>
              <span class="label label-info" style='float:right;'><%= type %></span>
              <h3 id='scientific_name'> </h3>
              <div style="width:100%;text-align:center;"><span class='klinks2' id='taxonomy'></span></div>
              <table style='width:100%;margin-top:20px;'>
                <tr>	
                  <td>RNA Features <span class='klinks2' id='rnas'></span><td/>
                  <td>Contigs <span class='klinks2' id='contigs'></span> <td/>
                  <td>Genome Size <span class='klinks2' id='dna_size'></span> <td/>
                </tr>
                <tr>	
                  <td>Protein Encoding Genes <span class='klinks2' id='pegs'></span> <td/>
                  <td>GC Content <span class='klinks2' id='gc_content'></span> <td/>
                  <td>Complete <span class='klinks2' id='complete'></span> <td/>
                </tr>
              </table>

              <br/>
              <div class='btngrp'>
                <div class="btn-group">

                   <a href='#contig' class="btn btn-mini btn-success" id='conbtn' type="button">Contigs</a>
                   <a href='#peg' class="btn btn-mini btn-success" id='pegbtn' type="button">Genes</a>
                   <a href='#rnalink' class="btn btn-mini btn-success" id='rnabtn' type="button">RNAs</a>
                   <a href='#subsystem' class="btn btn-mini btn-success" id='subbtn' type="button">Subsystem</a>

                </div>
              </div>
            </div>

            <a name='contig' ></a>
            <div class='contig-enclosure'>

              <div id="gBrowser">
                <div id="contigContainer" align="center">
                  <div id="contigMenuContainer">
                  </div>
                   <br/>

                  <div id="contigButtonContainer" align="center">
                  </div>
                  <br/>

                  <div id="contigTrackContainer">
                  </div>


                  <div id="featureInfoContainer" style='width:80%;text-align:left;'>
                  </div>
                </div>
                <div id="gcContainer" style="display:none;">
                  <div id="gcMenuContainer">
                  </div>

                  <svg id="gcSVG" width="450" height="500">
                    <g id="gcViewport"></g>
                  </svg>

                </div>
              </div>

                  <div class='credits'> 
                    <p class="text-right">Credits: Bill Riehl &amp; Paramvir Dehal - LBL</p>
                  </div>

                <!--
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Contig</th>
                  </tr>
                </thead>
                <tbody id='contig'>
                </tbody>
              </table>
              -->
            </div>

            <a name='peg' ></a>
            <div class='pegs-enclosure'>
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Genes</th>
                    <th>KBase ID</th>
                  </tr>
                </thead>
                <tbody id='pegsdata'>
                  <tr><td colspan='3'>
                    <img src='/services/search/libs/imgs/loader.gif' style='text-align:center;padding-left:330px;padding-top:10px;' />
                </td></tr>
                </tbody>
              </table>
            </div>

            <a name='rnalink' ></a>
            <div class='rnas-enclosure'>
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>RNA</th>
                    <th>KBase ID</th>
                  </tr>
                </thead>
                <tbody id='rnasdata'>
                  <tr><td colspan='3'>
                    <img src='/services/search/libs/imgs/loader.gif' style='text-align:center;padding-left:330px;padding-top:10px;' />
                </td></tr>
                </tbody>
              </table>
            </div>

            <a name='subsystem' ></a>
            <div class='subsystem-enclosure'>
              <table class="table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Function In Cell</th>
                    <th>Version</th>
                  </tr>
                </thead>
                <tbody id='subsystem'>
                </tbody>
              </table>
            </div>




            </div>

          </div>


      </div>


    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/services/search/libs/bootstrap/js/jquery-1.8.3.min.js"></script>
    <script src="/services/search/libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="/services/search/libs/js/jquery.highlight.js"></script>
    <script src="/services/search/libs/js/d3.v2.min.js"></script>
    <script src="/services/search/libs/js/kbase-cdmi.js"></script>
    <script src="/services/search/libs/js/kbase-protein-info.js"></script>
    <script src="/services/search/libs/js/genome-overview.js"></script>
	  <script src="/services/search/libs/js/kbase-contig-widget.js"></script>
    <script src="/services/search/libs/common.js"></script>
    <script src="/services/search/libs/js/common.js"></script>
  </body>
</html>


  <script>


    var genes = function genes( fid, count ) {

      var str0 = "<tr><td colspan='3'><div style='width:100%;padding-top:40px;text-align:center;padding-left:0px;'><img src='/services/search/libs/imgs/loader.gif' /></div></td></tr>";
      $('#pegsdata').html( str0 ); 

      var gcount = '';
      if ( count === 'full') {
        gcount = '?count=all';
      }

      var ftype = 'CDS'

      $.post('/services/search/ajax/features/' + ftype + '/'+fid + gcount,
      function(data, status ) {
        var str = "";
        if ( status === 'success' ) {
          if ($.isEmptyObject(data.data)) {
            $('#pegs-enclosure').hide();
            $('#pegbtn').addClass('disabled');
            } else {
            var alldata = data;
            var count = alldata.count;
            var returned = alldata.returned;
            var result = alldata.data;
            for (var i = 0; i < result.length; i++ ) {
              var txt = result[i];
              var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt.id +'?type=Gene">'+ txt.function +'</a></td><td><a href="/services/search/details/'+ txt.id +'?type=Gene">'+ txt.id +'</a></td></tr>';
              str = str + markup;
              //$('#co-expressed').html( $('#co-expressed').html() + markup);
            }

            if (gcount === '') {
              if ( alldata.remaining > 0 ) {
                var markup2 = '<tr><td colspan="3" style="text-align:right;"><button class="btn btn-primary btn-small" onclick="genes(\''+fid +'\', \'full\');" ><b>'+ count + '</b>' + ' More ... '+ '</button></td></tr>';
                str = str + markup2;
              }
            }
            $('#pegsdata').html( str );
          }
          } else {
          $('#pegs-enclosure').hide();
          $('#pegbtn').addClass('disabled');
        }
      });
    };

    var rna = function rna( fid, count ) {

      var str0 = "<tr><td colspan='3'><div style='width:100%;padding-top:40px;text-align:center;padding-left:0px;'><img src='/services/search/libs/imgs/loader.gif' /></div></td></tr>";
      $('#rnasdata').html( str0 ); 

      var gcount = '';
      if ( count === 'full') {
        gcount = '?count=all';
      }

      var ftype = 'rna'

      $.post('/services/search/ajax/features/' + ftype + '/'+fid + gcount,
      function(data, status ) {
        var str = "";
        if ( status === 'success' ) {
          if ($.isEmptyObject(data.data) || data.returned === 0) {
            $('.rnas-enclosure').hide();
            $('#rnabtn').addClass('disabled');
            } else {
            var alldata = data;
            var count = alldata.count;
            var returned = alldata.returned;
            var result = alldata.data;
            for (var i = 0; i < result.length; i++ ) {
              var txt = result[i];
              var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt.id +'?type=RNA">'+ txt.function +'</a></td><td><a href="/services/search/details/'+ txt.id +'?type=RNA">'+ txt.id +'</a></td></tr>';
              str = str + markup;
            }

            if (gcount === '') {
              if ( alldata.remaining > 0 ) {
                var markup2 = '<tr><td colspan="3" style="text-align:right;"><button class="btn btn-primary btn-small" onclick="rna(\''+fid +'\', \'full\');" ><b>'+ count + '</b>' + ' More ... '+ '</button></td></tr>';
                str = str + markup2;
              }
            }
            $('#rnasdata').html( str);
          }
          } else {
          $('.rnas-enclosure').hide();
          $('#rnabtn').addClass('disabled');
        }
      });

    };


    $(function () {

		/*
		var fid = 'kb|g.0.peg.1089';
		var fid = 'kb|g.0.ar.44';
		var fid = 'kb|g.0.peg.1457';
		var fid = 'kb|g.8776';
		var fid = 'kb|g.0.rna.2';
		var fid = 'kb|g.0.peg.133';
		*/

		var fid = '<%= keyword %>';

		var fids = [fid];
    var api = new CDMI_API('http://kbase.us/services/cdmi_api');

    api.genomes_to_genome_data_async(fids, 
			function (results) {
				if ($.isEmptyObject(results)) {
				} else {
					var result = results[fid];
					//alert(JSON.stringify(result));
					for (var id in results[fid]) {
						//alert(id);
						var value = result[id];
						if ( id === 'taxonomy' ) {
							var tax = value.replace(/;/g, ' <i class="icon-arrow-right"></i> ');
              //var tax = value.replace(/;/g, '<br/> &nbsp; &nbsp; &nbsp;<img src="/services/search/libs/imgs/tax.png" /> ');
							$('#' + id).html(tax);
						} else if ( id === 'gc_content' ) {
              var gc =  value;
              var gc = Number(gc).toFixed(2);
							$('#' + id).text(gc + ' %');
              //alert(gc);

						} else if ( id === 'complete' ) {
							if ( value === '1' ) {
							$('#' + id).html('<i class="icon-ok-sign"></i>');
							} else {
								$('#' + id).text(value);
							}
						} else {
							$('#' + id).text(value);
						}
					}
				}
            }, function( error ) {
              alert(error);
        });


        api.genomes_to_subsystems_async(fids, 
			function (results) {
				if ($.isEmptyObject(results)) {
					$('#subsystem-enclosure').hide();
					$('#subbtn').addClass('disabled');
				} else {
          var str = "";
					var result = results[fid];
					//alert(JSON.stringify(result));
					for (var i = 0; i < result.length; i++ ) {
						var txt = result[i];
                		var markup = '<tr><td>'+ (i+1) + '</td><td>'+ txt[1] +'</td><td>'+txt[0]+'</td></tr>';
            str = str + markup;
						if ( i == 10 ) {
							var markup2 = '<tr><td> &nbsp;</td><td> &nbsp; </td><td><b> .. '+ (result.length - 9) +' more </b></td></tr>';
							$('#subsystem').html( $('#subsystem').html() + markup2);
							break;
						}
						//$('#subsystem').html( $('#subsystem').html() + markup);
						$('#subsystem').html( str);
					}
				}
            }, function( error ) {
              alert(error);
        });

        /*
        api.genomes_to_contigs_async(fids, 
			function (results) {
				if ($.isEmptyObject(results)) {
					$('#contig-enclosure').hide();
					$('#conbtn').addClass('disabled');
				} else {
					var result = results[fid];
					for (var i = 0; i < result.length; i++ ) {
						var txt = result[i];
                		var markup = '<tr><td>'+ (i+1) + '</td><td>'+ txt + '</td></tr>';
						$('#contig').html( $('#contig').html() + markup);
						if ( i == 19 ) {
							var markup2 = '<tr><td> &nbsp; </td><td><b> ..'+ (results.length - 20) +' more </b> </td></tr>';
							$('#contig').html( $('#contig').html() + markup2);
							break;
						}
					}
				}
            }, function( error ) {
              alert(error);
        });

        api.genomes_to_fids_async(fids, ['CDS'],
			function (results) {
				if ($.isEmptyObject(results)) {
					$('#pegs-enclosure').hide();
					$('#pegbtn').addClass('disabled');
				} else {
					var result = results[fid];
					//alert(JSON.stringify(result.length));
					//alert(result.length);
					for (var i = 0; i < result.length; i++ ) {
						var txt = result[i];
						var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt + '">'+txt+'</a></td></tr>';
						$('#pegsdata').html( $('#pegsdata').html() + markup);
						if ( i == 19 ) {
							var markup2 = '<tr><td> &nbsp; </td><td> <b>.. '+ (result.length - 20) +' more </b> </td></tr>';
							$('#pegsdata').html( $('#pegsdata').html() + markup2);
							break;
						}
					}
				}
            }, function( error ) {
              alert(error);
        });

        api.genomes_to_fids_async(fids, ['rna'],
			function (results) {
				if ($.isEmptyObject(results)) {
					$('#rnas-enclosure').hide();
					$('#rnabtn').addClass('disabled');
				} else {
					var result = results[fid];
					//alert(JSON.stringify(result));
					//alert(result.length);
					for (var i = 0; i < result.length; i++ ) {
						var txt = result[i];
						var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt + '">'+txt+'</a></td></tr>';
						$('#rnasdata').html( $('#rnasdata').html() + markup);
						if ( i == 19 ) {
							var markup2 = '<tr><td> &nbsp; </td><td> <b>.. '+ (result.length - 20) +' more </b> </td></tr>';
							$('#rnasdata').html( $('#rnasdata').html() + markup2);
							break;
						}
					}
				}
            }, function( error ) {
              alert(error);
        });
        function contigs( fid ) {
          $.post('/services/search/ajax/contigs/'+fid,
          function(data, status ) {
            var str = "";
            if ( status === 'success' ) {
              if ($.isEmptyObject(data.data)) {
                $('.contig-enclosure').hide();
                $('#conbtn').addClass('disabled');
              } else {
                var alldata = data;
                var count = alldata.count;
                var returned = alldata.returned;
                var result = alldata.data;
                for (var i = 0; i < result.length; i++ ) {
                  var txt = result[i];
                  //var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt.id +'?type=Gene">'+ txt.function +'</a></td><td><a href="/services/search/details/'+ txt.id +'?type=Gene">'+ txt.id +'</a></td></tr>';
                  var markup = '<tr><td>'+ (i+1) + '</td><td>'+ txt.function +'</td></tr>';
                  str = str + markup;
                  //$('#co-expressed').html( $('#co-expressed').html() + markup);
                }
                if ( alldata.remaining > 0 ) {
                  var markup2 = '<tr><td colspan="2" style="text-align:right;"><b>'+ count + '</b>' + ' More ... '+ '</td></tr>';
                  str = str + markup2;
                }
                $('#contig').html( $('#contig').html() + str);
              }
            } else {
              $('.contig-enclosure').hide();
              $('#conbtn').addClass('disabled');
            }
          });
      };
        */

        var genes = function genes( fid, count ) {

          var gcount = '';
          if ( count === 'full') {
            gcount = '?count=all';
          }

          var ftype = 'CDS'

          $.post('/services/search/ajax/features/' + ftype + '/'+fid + gcount,
          function(data, status ) {
            var str = "";
            if ( status === 'success' ) {
              if ($.isEmptyObject(data.data)) {
                $('#pegs-enclosure').hide();
                $('#pegbtn').addClass('disabled');
              } else {
                var alldata = data;
                var count = alldata.count;
                var returned = alldata.returned;
                var result = alldata.data;
                for (var i = 0; i < result.length; i++ ) {
                  var txt = result[i];
                  var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt.id +'?type=Gene">'+ txt.function +'</a></td><td><a href="/services/search/details/'+ txt.id +'?type=Gene">'+ txt.id +'</a></td></tr>';
                  str = str + markup;
                }

                if (gcount === '') {
                  if ( alldata.remaining > 0 ) {
                    var markup2 = '<tr><td colspan="3" style="text-align:right;"><button class="btn btn-primary btn-small" onclick="genes(\''+fid +'\', \'full\');" ><b>'+ count + '</b>' + ' More ... '+ '</button></td></tr>';
                    str = str + markup2;
                  }
                }
                //$('#pegsdata').html( $('#pegsdata').html() + str);
                $('#pegsdata').html( str);
              }
            } else {
              $('#pegs-enclosure').hide();
              $('#pegbtn').addClass('disabled');
            }
          });
      };

      var rna = function rna( fid, count ) {

        var gcount = '';
        if ( count === 'full') {
          gcount = '?count=all';
        }

        var ftype = 'rna'

        $.post('/services/search/ajax/features/' + ftype + '/'+fid + gcount,
        function(data, status ) {
          var str = "";
          if ( status === 'success' ) {
            if ($.isEmptyObject(data.data) || data.returned === 0) {
              $('.rnas-enclosure').hide();
              $('#rnabtn').addClass('disabled');
            } else {
              var alldata = data;
              var count = alldata.count;
              var returned = alldata.returned;
              var result = alldata.data;
              for (var i = 0; i < result.length; i++ ) {
                var txt = result[i];
                var markup = '<tr><td>'+ (i+1) + '</td><td><a href="/services/search/details/'+ txt.id +'?type=RNA">'+ txt.function +'</a></td><td><a href="/services/search/details/'+ txt.id +'?type=RNA">'+ txt.id +'</a></td></tr>';
                str = str + markup;
              }

              if (gcount === '') {
                if ( alldata.remaining > 0 ) {
                  var markup2 = '<tr><td colspan="3" style="text-align:right;"><button class="btn btn-primary btn-small" onclick="rna(\''+fid +'\', \'full\');" ><b>'+ count + '</b>' + ' More ... '+ '</button></td></tr>';
                  str = str + markup2;
                }
              }
              $('#rnasdata').html( str);
            }
          } else {
            $('.rnas-enclosure').hide();
            $('#rnabtn').addClass('disabled');
          }
        });

      };


      setTimeout( genes, 100, fid, '10' );
      setTimeout( rna, 3000, fid, '10' );
      //setTimeout( contigs, 2000, fid );

    })
    </script>

