!function(t,e){function i(t,e){function i(){}i.prototype=e.prototype;var s=new i;s.constructor=t,t.prototype=s}var s,n=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},a=function(t){return"willChangeValueFor"+n(t)},o=function(t){return"didChangeValueFor"+n(t)},r=function(e){var i=t(e).prop("tagName").toLowerCase();return i.match(/^(input|select|textarea)$/)?"checkbox"==t(e).attr("type")?{setter:"checked",getter:"checked"}:{setter:"val",getter:"val"}:{setter:"text",getter:"text"}};makeBindingCallback=function(i,s,n,a,o){return t.proxy(function(s,n){s.preventDefault(),s.stopPropagation();var r=n.newValue;a.transformedValue!=e&&(r=a.transformedValue(r)),"checked"==o.setter?t(i).attr(o.setter,r):t(i)[o.setter](r)},t(i))},makeBindingBlurCallback=function(i,s,n,a,o){return t.proxy(function(r){if("keypress"!=r.type||13==r.which){r.preventDefault(),r.stopPropagation();var l;if(l="checked"==o.getter?this.is(":checked")?!0:!1:this[o.getter](),l!=this.data("kbase_bindingValue")){if(a.validator!=e){var d=a.validator(l);if(!d.success)return t(i).data("validationError.kbaseBinding",d.msg),this.popover({placement:"right",title:"Validation error",content:t.proxy(function(){return this.data("validationError.kbaseBinding")},t(i)),trigger:"manual",html:!0}),this.popover("show"),void 0;t(i).popover("hide"),d.newVal&&(l=d.newVal)}a.reverseTransformedValue!=e&&(l=a.reverseTransformedValue(l));var c=s.__attributes[n].setter;s[c](l)}}},t(i))},makeBindingFocusCallback=function(e,i,s){return t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.data("kbase_bindingValue",this[s.getter]())},t(e))},t.fn.kb_bind=function(i,s,n,a){if(this.length>1){var l=arguments;return t.each(this,function(e,i){t.fn.kb_bind.apply(t(i),l)}),this}a==e&&(a=r(this)),n==e&&(n={});var d=o(s);i.on(d,makeBindingCallback(this,i,s,n,a)),t(this).on("blur.kbaseBinding",makeBindingBlurCallback(this,i,s,n,a)),t(this).on("focus.kbaseBinding",makeBindingFocusCallback(this,n,a));var c=t(this).prop("tagName").toLowerCase();c.match(/^(input)$/)&&(t(this).on("keypress.kbaseBinding",makeBindingBlurCallback(this,i,s,n,a)),"checkbox"==t(this).attr("type")&&t(this).on("change.kbaseBinding",makeBindingBlurCallback(this,i,s,n,a)));var p=i.__attributes[s].getter,h=i[p]();return n.transformedValue!=e&&(h=n.transformedValue(h)),"checked"==a.setter?t(this).attr(a.setter,h):t(this)[a.setter](h),this},t.fn.kb_unbind=function(i,s,n,a,l){if(this.length>1){var d=arguments;return t.each(this,function(e,i){t.fn.kb_unbind.apply(t(i),d)}),this}l==e&&(l=r(this)),a==e&&(a={});var c=o(s);i.off(c,makeBindingCallback(this,i,s,a,l)),t(this).off("blur.kbaseBinding",makeBindingBlurCallback(this,i,s,a,l)),t(this).off("focus.kbaseBinding",makeBindingBlurCallback(this,a,l));var p=t(this).prop("tagName").toLowerCase();return p.match(/^(input)$/)&&(t(this).off("keypress.kbaseBinding",makeBindingEnterCallback(this,i,s,a,l)),"checkbox"==t(this).attr("type")&&t(this).off("change.kbaseBinding",makeBindingBlurCallback(this,i,s,a,l))),this};var l={};s===e&&(s=window.KBase={_functions:{getter:function(t){return function(){return this.valueForKey(t)}},setter:function(t){return function(e){return this.setValueForKey(t,e)}},getter_setter:function(t){return function(e){return 1==arguments.length?this.setValueForKey(t,e):this.valueForKey(t)}}}}),t.jqElem=function(e){var i="<"+e+">";return i.match(/^(area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track)/)||(i+="</"+e+">"),t(i)},t.kbObject=function(i,s,n,a){return a==e&&(a=!1),t.KBWidget(i,s,n,a)},t.KBWidget=function(n,a,o,r){r==e&&(r=!0);var d=function(e){return this.$elem=e,this.options=t.extend(!0,{},o.options,this.constructor.prototype.options),this},c=n;c=c.replace(/^kbase/,""),c=c.charAt(0).toLowerCase()+c.slice(1),s[c]=function(i,s){var n=new d;return s==e&&(s=t.jqElem("div")),n.$elem=s,n.init(i),n._init=!0,n.trigger("initialized"),n},l[n]=d,o==e&&(o=a,a="kbaseWidget",o==e&&(o={})),a&&i(d,l[a]);var p=t.extend(!0,{},o);d.prototype.__attributes={},p._accessors!=e&&(t.each(p._accessors,t.proxy(function(t,i){var n={name:i,setter:i,getter:i,type:"rw"};if("object"==typeof i){n.setter=i.name,n.getter=i.name;for(var a in i)n[a]=i[a]}d.prototype.__attributes[n.name]=n,n.setter==n.getter&&n.type.match(/rw/)?d.prototype[n.getter]=s._functions.getter_setter(n.name):(n.type.match(/w/)&&n.setter!=e&&(d.prototype[n.setter]=s._functions.setter(n.name)),n.type.match(/r/)&&n.getter!=e&&(d.prototype[n.getter]=s._functions.getter(n.name)))},this)),p._accessors=e);var h=t.extend(!0,{},d.prototype.__attributes,l[a].prototype.__attributes);d.prototype.__attributes=h;for(var u in p)d.prototype[u]=t.isFunction(p[u])?function(t,e){var i=function(){throw"No parent method defined! Play by the rules!"},s=function(){throw"No parent method defined! Play by the rules!"};if(a)var i=function(){return l[a].prototype[t].apply(this,arguments)},s=function(t){return l[a].prototype[t].apply(this,Array.prototype.slice.call(arguments,1))};return function(){var t=this._super,n=this._superMethod;this._super=i,this._superMethod=s;var a=e.apply(this,arguments);return this._super=t,this._superMethod=n,a}}(u,p[u]):p[u];return a&&(d.prototype.options=t.extend(!0,{},l[a].prototype.options,d.prototype.options)),r&&(t.fn[n]=function(i){if(this.length>1){var s=arguments;return t.each(this,function(e,i){t.fn[n].apply(t(i),s)}),this}return this.data(n)==e&&this.data(n,new d(this)),d.prototype[i]?d.prototype[i].apply(this.data(n),Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?(t.error("Method "+i+" does not exist on "+n),this):($w=this.data(n),$w._init||($w=d.prototype.init.apply($w,arguments)),$w._init=!0,$w.trigger("initialized"),$w)}),d.prototype[n]=function(){return t.fn[n].apply(this.$elem,arguments)},t.fn[n]},t.KBWidget("kbaseWidget",{_accessors:["wing","wong"],element:function(){return this},dbg:function(t){window.console&&console.log(t)},callAfterInit:function(t){var e=this,i=function(){var i=arguments.callee;e._init?t():setTimeout(i,10)};return i(),i},init:function(i){this._attributes={};var s=t.extend(!0,{},this.options);this.options=t.extend(!0,{},s,i);for(attribute in this.__attributes)this.options[attribute]!=e&&this.setValueForKey(attribute,this.options[attribute]);return this},alert:function(t){return t==e&&(t=this.data("msg")),this.data("msg",t),this},valueForKey:function(t){return this._attributes[t]},setValueForKey:function(t,i){var s=e,n=this.valueForKey(t);if(i!=n){var r=a(t);if(s={oldValue:n,newValue:i},this.trigger(r,s),this._attributes[t]=s.newValue,s.newValue!=n){var l=o(t);this.trigger(l,s)}}return this.valueForKey(t)},data:function(t,i){return this.options._storage==e&&(this.options._storage={}),2==arguments.length&&(this.options._storage[t]=i),t!=e?this.options._storage[t]:this.options._storage},_rewireIds:function(i,s){return s==e&&(s=i),i.attr("id")&&(s.data(i.attr("id"),i),i.removeAttr("id")),t.each(i.find("[id]"),function(){s.data(t(this).attr("id"),t(this)),t(this).removeAttr("id")}),i},sortCaseInsensitively:function(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0},sortByKey:function(t,e){return e?function(e,i){return e[t].toLowerCase()<i[t].toLowerCase()?-1:e[t].toLowerCase()>i[t].toLowerCase()?1:0}:function(e,i){return e[t]<i[t]?-1:e[t]>i[t]?1:0}},trigger:function(){this.$elem.trigger.apply(this.$elem,arguments)},on:function(){this.$elem.on.apply(this.$elem,arguments)},off:function(){this.$elem.off.apply(this.$elem,arguments)},makeObserverCallback:function(e,i,s){return t.proxy(function(t,i){t.preventDefault(),t.stopPropagation(),s.call(this,t,e,i)},this)},observe:function(t,e,i){t.on(e,t,this.makeObserverCallback(t,e,i))},unobserve:function(t,e,i){t.off(e,t,this.makeObserverCallback(t,e,i))},kb_bind:function(t,e,i){var s=o(e);this.observe(t,s,i)},kb_unbind:function(t,e,i){var s=o(e);this.unobserve(t,s,i)},uuid:function(){for(var t="",e=0;32>e;e++)t+=Math.floor(16*Math.random()).toString(16).toUpperCase();return t}})}(jQuery),function(t,e){t.KBWidget("kbaseAccordion","kbaseWidget",{version:"1.0.0",options:{fontSize:"100%"},init:function(e){return this._super(e),this.options.client&&(this.client=this.options.client),this.appendUI(t(this.$elem)),this},appendUI:function(i,s){s==e&&(s=this.options.elements);var n=this.options.fontSize,a=t("<div></div>").addClass("accordion").css("font-size",n).attr("id","accordion");t.each(s,t.proxy(function(i,s){a.append(t("<div></div>").addClass("accordion-group").append(t("<div></div>").addClass("accordion-heading").append(t("<i></i>").css("margin-right","5px").css("margin-left","3px").addClass("icon-chevron-right").addClass("pull-left").css("height","22px").css("line-height","22px").css("color","gray")).append(t("<a></a>").addClass("accordion-toggle").css("padding","0px").attr("href","#").attr("title",s.title).css("height","22px").css("line-height","22px").append(s.title).bind("click",function(i){i.preventDefault();var s=t(this).closest(".accordion").find(".in"),n=t(this).parent().next();if(s!=e){s.collapse("hide");var a=s.parent().first().find("i");a.removeClass("icon-chevron-down"),a.addClass("icon-chevron-right")}if(n.get(0)!=s.get(0)){n.collapse("show");var a=t(this).parent().find("i");a.removeClass("icon-chevron-right"),a.addClass("icon-chevron-down")}}))).append(t("<div></div>").addClass("accordion-body").append(t("<div></div>").addClass("accordion-inner").append(s.body))))},this)),this._rewireIds(a,this),i.append(a),a.find(".accordion-body").collapse("hide")}})}(jQuery),function(t,e){t.KBWidget("kbaseAuthenticatedWidget","kbaseWidget",{version:"1.0.0",_accessors:[{name:"auth",setter:"setAuth"},"sessionId","authToken","user_id","loggedInCallback","loggedOutCallback","loggedInQueryCallback"],options:{auth:e},init:function(i){return this._super(i),t(document).on("loggedIn.kbase",t.proxy(function(t,e){this.setAuth(e),this.loggedInCallback&&this.loggedInCallback(t,e)},this)),t(document).on("loggedOut.kbase",t.proxy(function(t){this.setAuth(e),this.loggedOutCallback&&this.loggedOutCallback(t)},this)),t(document).trigger("loggedInQuery",t.proxy(function(e){this.setAuth(e),e.kbase_sessionid&&this.callAfterInit(t.proxy(function(){this.loggedInQueryCallback&&this.loggedInQueryCallback(e)},this))},this)),this},setAuth:function(t){this.setValueForKey("auth",t),t==e&&(t={}),this.sessionId(t.kbase_sessionid),this.authToken(t.token),this.user_id(t.user_id)},loggedInQueryCallback:function(t){this.loggedInCallback&&this.loggedInCallback(e,t)}})}(jQuery),function(t){t.KBWidget("kbaseBox","kbaseWidget",{version:"1.0.0",options:{canCollapse:!0,canCollapseOnDoubleClick:!1,controls:[],bannerColor:"lightgray",boxColor:"lightgray"},init:function(e){return this._super(e),this.options.canCollapse&&this.options.controls.push({icon:"icon-caret-up","icon-alt":"icon-caret-down",tooltip:{title:"collapse / expand",placement:"bottom"},callback:t.proxy(function(){this.data("content").slideToggle()},this)}),this.appendUI(t(this.$elem)),this},setBannerColor:function(t){this.data("banner").css("background-color",t)},startThinking:function(){this.data("banner").addClass("progress progress-striped active")},stopThinking:function(){this.data("banner").removeClass("progress progress-striped active")},appendUI:function(e){this.options.canCollapse;var i=t("<div></div>").append(t("<div></div>").css("text-align","left").css("font-size","70%").css("color","gray").append(this.options.precontent)).append(t("<div></div>").css("border","1px solid "+this.options.boxColor).css("padding","2px").append(t("<div></div>").attr("id","banner").css("width","100%").css("height","24px").css("margin-bottom","0px").css("box-shadow","none").css("background-color",this.options.bannerColor).css("border-radius","0px").append(t("<h5></h5>").attr("id","banner-text").addClass("text-left").css("text-align","left").css("text-shadow","none").css("color","black").css("font-size","14px").addClass("bar").css("padding","2px").css("margin","0px").css("position","relative").css("width","100%").bind("dblclick",function(e){e.preventDefault(),e.stopPropagation(),canCollapseOnDoubleClick&&t(this).parent().parent().children().last().collapse("toggle")}).append(t("<span></span>").attr("id","title")))).append(t("<div></div>").attr("id","content"))).append(t("<div></div>").css("text-align","right").css("font-size","70%").css("color","gray").append(this.options.postcontent));return this._rewireIds(i,this),this.options.controls&&this.data("banner-text").kbaseButtonControls({onMouseover:!1,controls:this.options.controls}),this.setTitle(this.options.title),this.setContent(this.options.content),e.append(i),this},setTitle:function(t){this.data("title").empty(),this.data("title").append(t)},setContent:function(t){this.data("content").empty(),this.data("content").append(t)},content:function(){return this.data("content")},controls:function(t){return this.data("banner-text").kbaseButtonControls("controls",t)}})}(jQuery),function(t,e){t.KBWidget("kbaseButtonControls","kbaseWidget",{version:"1.0.0",options:{controls:[],onMouseover:!0},init:function(e){return this._super(e),this._controls={},this.appendUI(t(this.$elem)),this},appendUI:function(e){return e.css("position","relative").prepend(t("<div></div>").addClass("btn-group").attr("id","control-buttons").css("right","0px").css("top","0px").css("position","absolute").css("margin-right","3px")),this._rewireIds(e,this),this.options.onMouseover&&e.mouseover(function(){t(this).children().first().show()}).mouseout(function(){t(this).children().first().hide()}).children().first().hide(),this.setControls(this.options.controls),this},controls:function(t){return t?this._controls[t]:this._controls},setControls:function(i){this.data("control-buttons").empty();for(control in this._controls)this._controls[control]=e;var s=this;t.each(i,t.proxy(function(i,n){if(!n.condition||0!=n.condition.call(this,n,s.options.context,this.$elem)){var a="btn btn-mini";n.type&&(a=a+" btn-"+n.type),tooltip=n.tooltip,"string"==typeof n.tooltip&&(tooltip={title:n.tooltip}),tooltip!=e&&tooltip.container==e;var o=t("<button></button>").attr("href","#").css("padding-top","1px").css("padding-bottom","1px").attr("class",a).append(t("<i></i>").addClass(n.icon)).tooltip(tooltip).bind("click",function(e){e.preventDefault(),e.stopPropagation(),n["icon-alt"]&&(t(this).children().first().toggleClass(n.icon),t(this).children().first().toggleClass(n["icon-alt"])),n.callback.call(this,e,s.options.context)});n.id&&(this._controls[n.id]=o),this.options.id&&o.data("id",this.options.id),this.data("control-buttons").append(o)}},this))}})}(jQuery),function(t,e){t.KBWidget("kbaseDataBrowser","kbaseAuthenticatedWidget",{version:"1.0.0",options:{title:"Data Browser",canCollapse:!0,height:"200px",types:{file:{icon:"icon-file"},folder:{icon:"icon-folder-close-alt","icon-open":"icon-folder-open-alt",expandable:!0}},content:[]},init:function(t){return this.targets={},this.openTargets={},this._super(t),this.appendUI(this.$elem),this},sortByName:function(t,e){return t.name.toLowerCase()<e.name.toLowerCase()?-1:t.name.toLowerCase()>e.name.toLowerCase()?1:0},appendContent:function(i,s){return t.each(i,t.proxy(function(i,n){var a=n.icon,o=n["icon-open"];a==e&&n.type!=e&&(a=this.options.types[n.type].icon,o=this.options.types[n.type]["icon-open"]),n.expandable==e&&n.type!=e&&(n.expandable=this.options.types[n.type].expandable);var r=t("<i></i>").addClass(n.open?o:a).css("color","gray"),l=t("<li></li>").attr("id",n.id).append(t("<a></a>").append(r).append(" ").append(n.label));if(n.data&&l.data("data",n.data),n.id&&(l.data("id",n.id),this.targets[n.id]=l),s.append(l),n.expandable){var d=t("<ul></ul>").addClass("nav nav-list");n.open||d.hide(),n.children!=e&&this.appendContent(n.children,d),s.append(d);var c=n.childrenCallback;n.children==e&&c==e&&n.type!=e&&(c=this.options.types[n.type].childrenCallback),l.bind("click",t.proxy(function(i){i.preventDefault(),i.stopPropagation(),r.toggleClass(o),r.toggleClass(a),d.is(":hidden")&&c!=e?c.call(this,n.id,t.proxy(function(t){d.empty(),this.appendContent(t,d),d.show("collapse"),this.openTargets[n.id]=!0},this)):d.is(":hidden")?(d.show("collapse"),this.openTargets[n.id]=!0):(d.hide("collapse"),this.openTargets[n.id]=!1)},this)),n.open&&n.children==e&&c!=e&&(r.toggleClass(o),r.toggleClass(a),d.hide(),l.trigger("click"))}var p=n.controls;p==e&&n.type!=e&&(p=this.options.types[n.type].controls),p&&l.kbaseButtonControls({controls:p,id:n.id,context:this})},this)),this._rewireIds(s,this),s},prepareRootContent:function(){return t("<ul></ul>").addClass("nav nav-list").css("height",this.options.height).css("overflow","auto").attr("id","ul-nav")},appendUI:function(t){var e=this.prepareRootContent();return this._rewireIds(e,this),this.appendContent(this.options.content,this.data("ul-nav")),t.kbaseBox({title:this.options.title,canCollapse:this.options.canCollapse,content:e,postcontent:this.options.postcontent}),t}})}(jQuery),function(t){t.KBWidget("kbaseDeletePrompt","kbasePrompt",{version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(e){return this._super(e),t("<div></div>").kbasePrompt({title:"Confirm deletion",body:"Really delete <strong>"+this.options.name+"</strong>?",controls:["cancelButton",{name:"Delete",type:"primary",callback:this.options.callback}]})}})}(jQuery),function(t){t.KBWidget("kbaseErrorPrompt","kbasePrompt",{version:"1.0.0",options:{controls:["cancelButton","okayButton"]},init:function(e){return this._super(e),t("<div></div>").kbasePrompt({title:e.title,body:t("<div></div>").attr("class","alert alert-error").append(t("<div></div>").append(t("<div></div>").addClass("pull-left").append(t("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(t("<div></div>").append(t("<strong></strong>").append(e.message)))),controls:["okayButton"]})}})}(jQuery),function(t,e){t.KBWidget("kbaseFormBuilder","kbaseWidget",{version:"1.0.0",options:{elements:[],defaultSize:50,defaultRowSize:5,defaultMultiSelectSize:5,dispatch:{text:"buildTextField",textarea:"buildTextArea",password:"buildSecureTextField",checkbox:"buildCheckbox",select:"buildSelectbox",multiselect:"buildSelectbox",radio:"buildRadioButton",string:"buildTextField",secure:"buildSecureTextField","enum":"buildSelectbox","boolean":"buildCheckbox"}},init:function(t){return this._super(t),this.$elem.append(this._buildForm(this.options.elements)),this},getFormValuesAsObject:function(){var e=this.getFormValues(),i={};return t.each(e,function(t,e){i[e[0]]=e.slice(1)}),i},getFormValues:function(){var t=[],i=this.data("formValues"),s=this.data("form").get(0);for(key in i){var n=i[key],a=n.name,o=n.type,r=[];if("[object NodeList]"==s[a])for(var l=0;l<s[a].length;l++)r.push(s[a][l]);else r=[s[a]];if("checkbox"==o)s[a].checked&&t.push([key]);else if("multiselect"==o){var d=[key],c=d;n.asArray&&(c=[],d.push(c));for(var p=0,l=0;l<s[a].length;l++)s[a][l].selected&&(p=1,c.push(s[a][l].value));p&&t.push(d)}else if("radio"==o){for(var d=[key],p=0,l=0;l<s[a].length;l++)s[a][l].checked&&(p=1,d.push(s[a][l].value));p&&t.push(d)}else{for(var h=[],l=0;l<r.length;l++)if(n.json){var u=JSON.parse(r[l].value);n.asArray&&(u=[u]),h.push(u)}else h.push(this.carve(r[l].value,n.split,n.asArray));if(h.length>0){if(1==h.length&&(h=h[0],0==h.length))continue;t.push([key,h])}}}if(this.options.returnArrayStructure!=e){for(var f=[],g={},l=0;l<t.length;l++)g[t[l][0]]=t[l][1];for(var l=0;l<this.options.returnArrayStructure.length;l++)f.push(g[this.options.returnArrayStructure[l]]);t=f}return t},carve:function(i,s,n){s=s==e?[]:"string"==typeof s?[s]:s.slice(0);var a=s.shift();if(a==e)return n&&"string"==typeof i&&(i=[i]),i;var o=new RegExp(" *"+a+" *");return"string"==typeof i?this.carve(i.split(o),s,n):(s.push(a),jQuery.each(i,t.proxy(function(t,e){i[t]=this.carve(e,s,n)},this)),i)},escapeValue:function(t){return t=t.replace(/"/g,'\\"'),'"'+t+'"'},getFormValuesAsString:function(){var t=this.getFormValues();if(this.options.returnArrayStructure!=e)return JSON.stringify(t);for(var i=[],s=0;s<t.length;s++){var n=t[s];if(1==n.length)i.push(n[0]);else for(var a=1;a<n.length;a++)this.data("formValues")[n[0]].valOnly?i.push(n[a]):"string"==typeof n[a]?i.push(n[0]+" "+this.escapeValue(n[a])):i.push(n[0]+" "+this.escapeValue(JSON.stringify(n[a])))}return i.join(" ")},_buildForm:function(i){var s=t("<form></form>").addClass("form-horizontal").bind("submit",function(){return!1});this.data("form",s);var n=this.data("formValues",{}),a=e,o={};return this.options.values!=e&&t.each(this.options.values,function(t,e){o[e[0]]=e[1]||1}),t.each(i,t.proxy(function(i,r){if(n[r.key]!=e){var l="FORM ERROR. KEY "+r.key+" IS DOUBLE DEFINED";return s=l,!1}n[r.key]=r,r.fieldset?(a==e||a.attr("name")!=r.fieldset)&&(a=t("<fieldset></fieldset>").attr("name",r.fieldset).append(t("<legend></legend>").append(r.fieldset)),s.append(a)):a=s;var d=r.label!=e?r.label:r.name,c=t("<label></label>").addClass("control-label").css("margin-right","10px").append(t("<span></span>").attr("title",r.label||r.name).append(d).attr("title",r.description)).bind("click",function(){t(this).next().children().first().focus()}),p=c.find("span");r.description&&p.tooltip(),o[r.key]!=e&&(r.value=r.checked=r.selected=o[r.key]);var h;if(this.options.dispatch[r.type])h=this[this.options.dispatch[r.type]](r);else{if(r.type==e){var l="FORM ERROR. KEY "+r.key+" HAS NO TYPE";return s=l,!1}h=this.buildTextField(r)}var u=t("<span></span>");u.css("display","inline-block"),u.append(h);var f=t("<button></button>").addClass("btn").attr("title","Add more").append(t("<i></i>").addClass("icon-plus")).bind("click",function(e){u.append(t("<br/>")),u.append(h.clone()),e.stopPropagation()});r.multi&&u.append(f),s.append(t("<div></div>").addClass("control-group").append(c).append(u))},this)),s},buildTextField:function(e){return t("<input/>").attr("type","text").attr("size",e.size||this.options.defaultSize).attr("value",e.value).attr("name",e.name)},buildTextArea:function(e){return t("<textarea></textarea>").attr("cols",e.size||this.options.defaultSize).attr("rows",e.rows||this.options.defaultRowSize).attr("name",e.name).append(e.value)},buildSecureTextField:function(e){return t("<input/>").attr("type","password").attr("size",e.size||this.options.defaultSize).attr("value",e.value).attr("name",e.name)},buildCheckbox:function(e){var i=t("<input/>").attr("type","checkbox").attr("name",e.name).attr("value",e.value);return e.checked&&i.attr("checked","checked"),i},buildRadioButton:function(e){var i=t("<span></span>").css("display","inline-block");return t.each(e.values,t.proxy(function(s,n){var a=t("<input/>").attr("type","radio").attr("name",e.name).attr("value",n);e.checked==n&&a.attr("checked","checked");var o=t("<label></label").append(a).append(e.names[s]||e.values[s]).css("clear","both").css("float","left");i.append(o)},this)),i},buildSelectbox:function(i){var s=t("<select></select>").attr("name",i.name);return"multiselect"==i.type&&s.attr("multiple","multiple").attr("size",i.size||this.options.defaultMultiSelectSize),i.names==e&&(i.names=[]),t.each(i.values,function(e,n){var a=i.names[e]||i.values[e],o=t("<option></option>").attr("value",n).append(a);"string"==typeof i.selected&&i.selected==n?o.attr("selected","selected"):"object"==typeof i.selected&&t.each(i.selected,function(t,e){e==n&&o.attr("selected","selected")}),s.append(o)}),s}})}(jQuery),function(t,e){t.KBWidget("kbaseIrisCommands","kbaseAccordion",{version:"1.0.0",options:{link:function(e){alert("clicked on "+t(e.target).text())},englishCommands:0,fontSize:"90%",overflow:!0,sectionHeight:"300px"},init:function(t){return this._super(t),t.client&&(this.client=t.client),this.commands=[],this.commandCategories={},this},completeCommand:function(t){for(var e=[],i=new RegExp("^"+t+".*"),s=0;s<this.commands.length;s++)this.commands[s].match(i)&&e.push(this.commands[s]);return e},commonPrefix:function(t,e){for(var i="",s=0;s<t.length&&s<e.length;s++){var n=t.charAt(s),a=e.charAt(s);if(n!=a)break;i+=n}return i},commonCommandPrefix:function(t){var e="";if(t.length>1){e=this.commonPrefix(t[0],t[1]);for(var i=2;i<t.length;i++)e=this.commonPrefix(e,t[i])}else e=t[0];return e},commandsMatchingRegex:function(t){for(var e=[],i=0;i<this.commands.length;i++)this.commands[i].match(t)&&e.push(this.commands[i]);return e.sort()},appendUI:function(i){this.client.valid_commands(t.proxy(function(s){var n=[];t.each(s,t.proxy(function(i,s){s.title;var a=t("<ul></ul>").addClass("unstyled").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible");t.each(s.items,t.proxy(function(t,i){var n=i.cmd;if(this.options.englishCommands){var o=MetaToolInfo(i.cmd);if(o!=e){var r=o(i.cmd);n=r.label}}this.commands.push(i.cmd),this.commandCategories[s.name]==e&&(this.commandCategories[s.name]=[]),this.commandCategories[s.name].push(i.cmd),a.append(this.createLI(i.cmd,n))},this)),n.push({title:s.title,category:s.name,body:a})},this)),this.loadedCallback(i,n)},this))},createLI:function(i,s,n){s==e&&(s=i),n==e&&(n=this.options.link);var a=t("<li></li>").append(t("<a></a>").attr("href","#").attr("title",i).data("type","invocation").text(s).bind("click",n));return a.kbaseButtonControls({context:this,controls:[{icon:"icon-question",callback:function(t,s){s.options.terminal!=e&&s.options.terminal.run(i+" -h")},id:"helpButton"}]}),a},loadedCallback:function(i,s){var n=this;t("input,textarea").on("focus.kbaseIrisCommands",t.proxy(function(){t(":focus").get(0)!=e&&t(":focus").get(0)!=this.data("searchField").get(0)&&this.data("focused",t(":focus"))},this)),this.data("focused",t(":focus"));var a=t.jqElem("form").addClass("form-search").css("margin-bottom","2px").append(t("<div></div>").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible").append(t("<div></div>").addClass("input-append").addClass("pull-right").css("margin-top","5px").attr("id","searchFieldBox").append(t("<input></input>").attr("type","text").addClass("input-small search-query").attr("name","search").css("padding-top","1px").css("padding-bottom","1px").attr("id","searchField").attr("size","50").keyup(t.proxy(function(e){if(e.preventDefault(),e.stopPropagation(),!(e.metaKey||e.altKey||e.ctrlKey)){var i=this.data("searchField").val();if(i.length<3)return 0==i.length&&this.data("test").animate({left:"-100%"},150),void 0;this.data("test").animate({left:"0px"},150);var s=new RegExp(i,"i"),a=this.commandsMatchingRegex(s),o=t.jqElem("ul").css("font-size",this.options.fontSize).css("padding-left","15px").addClass("unstyled");t.each(a,t.proxy(function(t,e){o.append(this.createLI(e,e,function(t){n.options.link.call(this,t)}))},this)),a.length||o.append(t("<li></li>").css("font-style","italic").text("No matching commands found")),this.data("searchResults").empty(),this.data("searchResults").append(o),this.data("searchResults").prepend(t.jqElem("div").css("position","relative").css("top","2px").css("left","90%").append(t.jqElem("button").addClass("btn btn-mini").append(t.jqElem("i").addClass("icon-remove")).on("click",t.proxy(function(){this.data("searchField").val(""),this.data("searchField").trigger("keyup")},this))))}},this))).append(t.jqElem("button").addClass("btn btn-small").css("padding-top","1px").css("padding-bottom","1px").attr("id","search-button").append(t.jqElem("i").attr("id","search-button-icon").addClass("icon-search")).on("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.data("searchField").trigger("keyup")},this))))),o=t.jqElem("div").kbaseBox({title:"Command list",content:t.jqElem("div").append(t.jqElem("div").attr("id","command-container").css("max-height",this.options.overflow?this.options.sectionHeight:"5000px").css("overflow",this.options.overflow?"auto":"visible").append(t.jqElem("div").attr("id","test").css("position","relative").css("left","-100%").css("width","200%").append(t.jqElem("div").text("This is my left div right here").css("width","50%").css("float","left").attr("id","searchResults")).append(t.jqElem("div").css("width","50%").css("float","right").append(t.jqElem("div").attr("id","all-commands").css("white-space","nowrap"))))).append(a)});i.append(o.$elem),this._rewireIds(o.$elem,this),this._superMethod("appendUI",this.data("all-commands"),s),this.data("accordion").css("margin-bottom","0px")}})}(jQuery),function(t,e){t.KBWidget("kbaseIrisFileBrowser","kbaseDataBrowser",{version:"1.0.0",_accessors:["invocationURL","client","addFileCallback","editFileCallback","singleFileSize","chunkSize","stalledUploads"],options:{stalledUploads:{},uploadDir:".uploads",concurrentUploads:4,singleFileSize:15e6,chunkSize:5e6,title:"File Browser",root:"/",types:{file:{controls:[{icon:"icon-minus",callback:function(e,i){i.deleteFile(t(this).data("id"),"file")},id:"removeButton"},{icon:"icon-download-alt",callback:function(e,i){i.openFile(t(this).data("id"))},id:"viewButton"},{icon:"icon-pencil",callback:function(i,s){s.editFileCallback()!=e&&s.editFileCallback()(t(this).data("id"),s)},id:"editButton",condition:function(t,i){var s=this.$elem.data("data").size;return s>i.singleFileSize()?!1:i.editFileCallback()==e?!1:!0}},{icon:"icon-arrow-right",callback:function(i,s){s.addFileCallback()!=e&&s.addFileCallback()(t(this).data("id"),s)},id:"addButton"}]},folder:{childrenCallback:function(t,e){this.listDirectory(t,function(t){e(t)})},controls:[{icon:"icon-minus",callback:function(e,i){i.deleteFile(t(this).data("id"),"folder")},id:"removeDirectoryButton"},{icon:"icon-plus",callback:function(e,i){i.addDirectory(t(this).data("id"))},id:"addDirectoryButton"},{icon:"icon-arrow-up",callback:function(e,i){i.data("active_directory",t(this).data("id")),i.data("fileInput").trigger("click")},id:"uploadFileButton"}]}}},uploadFile:function(){this.data("fileInput").trigger("click")},init:function(e){return this._super(e),this.listDirectory(this.options.root,t.proxy(function(t){this.appendContent(t,this.data("ul-nav"))},this)),this},checkStalledUploads:function(){this.client().list_files(this.sessionId(),"/",this.options.uploadDir).done(t.proxy(function(e){var i=e[0];t.each(i,t.proxy(function(e,i){this.client().get_file(this.sessionId(),"chunkMap","/"+this.options.uploadDir+"/"+i.name).done(t.proxy(function(t){var e;try{var e=JSON.parse(t)}catch(i){this.dbg("Could not load chunk map"),this.dbg(i)}for(;e.chunks.length>0;){var s=e.chunks.shift();e.chunksByName[s.name]=s,e.doneChunks.push(s)}this.checkAndMergeChunks(e)},this))},this))},this))},loggedInCallback:function(e,i){i.success&&(this.refreshDirectory("/"),this.client().make_directory(this.sessionId(),"/",this.options.uploadDir).always(t.proxy(function(){this.checkStalledUploads()},this)))},loggedOutCallback:function(){this.data("ul-nav").empty()},prepareRootContent:function(){var e=this._super();e.css("height",parseInt(this.options.height)-25+"px");var i=t("<div></div>").css("margin-top","2px");return i.kbaseButtonControls({onMouseover:!1,context:this,controls:[{icon:"icon-plus",callback:function(t,e){e.addDirectory("/")}},{icon:"icon-arrow-up",callback:function(e,i){i.data("active_directory",t(this).data("id")),i.data("fileInput").trigger("click")}}]}),t("<div></div>").css("height",this.options.height).append(e).append(i).append(t("<input></input>").attr("type","file").attr("id","fileInput").css("display","none").attr("multiple","multiple").bind("change",t.proxy(this.handleFileSelect,this)))},refreshDirectory:function(i){if(this.sessionId()==e)return this.data("ul-nav").empty(),void 0;var s;if("/"==i)s=this.data("ul-nav");else{var n=this.targets[i];if(n==e)return;s=n.next()}var a=new RegExp("^"+i),o=[];for(var r in this.targets)r.match(a)&&!this.targets[r].next().is(":hidden")&&this.targets[r].next().is("ul")&&o.push(r);s.is(":hidden")||this.listDirectory(i,t.proxy(function(t){s.empty(),this.appendContent(t,s)},this),o),t.each(o,t.proxy(function(e,i){var s=this.targets[i].next();this.listDirectory(i,t.proxy(function(t){s.empty(),this.appendContent(t,s),s.show()
},this))},this))},listDirectory:function(e,i){this.client().list_files(this.sessionId(),"/",e,jQuery.proxy(function(e){var s=e[0],n=e[1],a=[],o=this;jQuery.each(s,t.proxy(function(t,e){e.full_path=e.full_path.replace(/\/+/g,"/"),a.push({type:"folder",id:e.full_path,label:e.name,open:o.openTargets[e.full_path]})},this)),jQuery.each(n,t.proxy(function(t,e){e.full_path=e.full_path.replace(/\/+/g,"/"),a.push({type:"file",id:e.full_path,label:e.name,data:e})},this)),a=a.sort(this.sortByKey("label","insensitively")),i(a)},this),t.proxy(function(t){this.dbg(t)},this))},handleFileSelect:function(i){i.preventDefault();var s=i.target.files||i.originalEvent.dataTransfer.files||i.dataTransfer.files;t.each(s,jQuery.proxy(function(i,s){var n="/";this.data("active_directory")&&(n=this.data("active_directory"));var a=s.name;this.data("override_filename")&&(a=this.data("override_filename"),this.data("override_filename",e));var o=n+"/"+a;o=o.replace(/\/\/+/g,"/");var r=this.uuid();if(this.trigger("updateIrisProcess",{pid:r,msg:"Uploading "+o+" ... 0%"}),s.size<=this.singleFileSize()){var l=new FileReader;l.onprogress=t.proxy(function(t){this.trigger("updateIrisProcess",{pid:r,msg:"Uploading "+o+" ... "+(100*t.loaded/t.total).toFixed(2)+"%"}),this.dbg("progress "+t.loaded/t.total),this.dbg(t)},this),l.onload=jQuery.proxy(function(t){this.client().put_file(this.sessionId(),a,t.target.result,n,jQuery.proxy(function(){this.trigger("removeIrisProcess",r),this.refreshDirectory(n)},this),jQuery.proxy(function(t){this.trigger("removeIrisProcess",r),this.dbg(t)},this))},this),l.readAsBinaryString(s)}else{var d=o;d=d.replace(/\//g,"::");var c=s.size,p=this.chunkSize(),h=1,u=0,f={chunks:[],doneChunks:[],chunksByName:{},size:0,fileName:a,upload_dir:n,fullFilePath:o,chunkUploadPath:d,fullUploadPath:this.options.uploadDir+"/"+d,pid:r};if(this.stalledUploads()[f.fullFilePath]!=e&&(this.data("resumed_chunkMap",this.stalledUploads()[f.fullFilePath]),this.stalledUploads()[f.fullFilePath]=e),this.data("resumed_chunkMap")!=e){f=this.data("resumed_chunkMap"),this.trigger("removeIrisProcess",r);var g=(100*f.doneChunks.length/(f.doneChunks.length+f.chunks.length)).toFixed(2);g>=100&&(g=99),this.trigger("updateIrisProcess",{pid:f.pid,msg:"Uploading "+f.fullFilePath+" ... "+g+"%"}),this.data("resumed_chunkMap",e)}else for(;c>0;){p>c&&(p=c),c-=p;var m="00000000",v=(m+h).slice(-8);f.chunks.push({chunk:h,name:"chunk."+v,start:u,end:u+p,size:p,complete:!1}),f.size+=p,u+=p,h++}var b=t.proxy(function(){t.each(f.chunks,function(t,e){f.chunksByName[e.name]=e});for(var e=this.makeChunkUploader(s,f),i=0;i<this.options.concurrentUploads;i++)e()},this);this.client().make_directory(this.sessionId(),"/"+this.options.uploadDir,f.chunkUploadPath).always(t.proxy(function(){this.client().put_file(this.sessionId(),"chunkMap",JSON.stringify(f,e,2),"/"+f.fullUploadPath).done(b).fail(t.proxy(function(t){this.dbg(t)},this))},this))}},this)),this.data("fileInput").val("")},makeChunkUploader:function(t,e){e.jobs=0;var i=this;return function(){var s=arguments.callee;if(e.chunks.length>0){var n=e.chunks.shift(),a=t.slice||t.webkitSlice||t.mozSlice,o=a.call(t,n.start,n.end),r=new FileReader;r.onloadend=function(t){t.target.readyState==FileReader.DONE&&i.client().put_file(i.sessionId(),n.name,t.target.result,"/"+e.fullUploadPath,function(){e.doneChunks.push(n);var t=(100*e.doneChunks.length/(e.jobs-1+e.doneChunks.length+e.chunks.length)).toFixed(2);t>=100&&(t=99),i.trigger("updateIrisProcess",{pid:e.pid,msg:"Uploading "+e.fullFilePath+" ... "+t+"%"}),e.jobs--,s()},function(){e.jobs--,e.chunks.push(n),s()})},e.jobs++,r.readAsBinaryString(o)}else 0==e.jobs&&i.checkAndMergeChunks(e,s)}},checkAndMergeChunks:function(i,s){this.client().list_files(this.sessionId(),"/"+this.options.uploadDir,i.chunkUploadPath,t.proxy(function(n){n[0];var a=n[1],o=!0,r=0,l={};jQuery.each(a,t.proxy(function(t,e){l[e.name]=e.size},this));var d=l.upload||0,c=[];if(i.doneChunks=i.doneChunks.sort(this.sortByKey("name")),t.each(i.doneChunks,t.proxy(function(t,s){var n=s.size;n==l[s.name]?(s.complete=!0,r++,c.push(s)):l[s.name]==e&&d>0?(d-=n,s.complete=!0,r++):(s.complete=!1,i.chunks.push(s),o=!1)},this)),i.doneChunks=c,0!=d){o=!1;var p=Object.keys(l).sort()[0],h=l[p];if(0!=d-h){var u=t("<div></div>").text("Uploading "+i.fullFilePath+" failed. Please start over");return u.kbaseButtonControls({onMouseover:!0,context:this,controls:[{icon:"icon-ban-circle",tooltip:"Cancel",callback:function(t,e){e.client().remove_directory(e.sessionId(),"/","/"+i.fullUploadPath,function(){e.trigger("removeIrisProcess",i.pid)})}}]}),this.trigger("updateIrisProcess",{pid:i.pid,content:u}),void 0}for(var c=[],f=0;f<i.doneChunks.length;f++){var g=i.doneChunks[f];g.name!=p&&c.push(g)}i.doneChunks=c,o=!0}if(o){var m=this.makeChunkMerger(i);m()}else if(s)s();else{var v=(100*i.doneChunks.length/(i.doneChunks.length+i.chunks.length)).toFixed(2);v>=100&&(v=99);var u=t("<div></div>").text("Uploading "+i.fullFilePath+" ...stalled at "+v+"%");u.kbaseButtonControls({onMouseover:!0,context:this,controls:[{icon:"icon-refresh",callback:function(t,e){e.data("resumed_chunkMap",i),e.data("fileInput").trigger("click")}},{icon:"icon-ban-circle",callback:function(t,e){e.client().remove_directory(e.sessionId(),"/","/"+i.fullUploadPath,function(){e.trigger("removeIrisProcess",i.pid),e.refreshDirectory("/"+target_dir)})}}]}),this.trigger("updateIrisProcess",{pid:i.pid,content:u}),this.stalledUploads()[i.fullFilePath]=i}},this))},makeChunkMerger:function(e){var i=this,s=e.fullUploadPath+"/upload",n=e.doneChunks.length?1/e.doneChunks.length:0,a=1;return function(){if(0==e.doneChunks.length)return i.client().rename_file(i.sessionId(),"/",s,e.fullFilePath,function(){i.client().remove_directory(i.sessionId(),"/",e.fullUploadPath,function(){i.trigger("removeIrisProcess",e.pid),i.refreshDirectory(e.upload_dir)})},function(t){this.dbg("rename file failure"),this.dbg(t)}),void 0;var o=e.doneChunks.shift(),r=arguments.callee;i.client().run_pipeline(i.sessionId(),"cat "+e.fullUploadPath+"/"+o.name+" >> "+s,[],0,"/",t.proxy(function(s){if(s){s[0];var l=s[1],d=(99+a++*n).toFixed(2);i.trigger("updateIrisProcess",{pid:e.pid,msg:"Uploading "+e.fullFilePath+" ... "+d+"%"}),l.length||i.client().remove_files(i.sessionId(),"/"+e.fullUploadPath,o.name,t.proxy(function(){r()},i))}},this),function(t){this.dbg("OMFG ERR"),this.dbg(t)})}},openFile:function(t){var e=this.options.invocationURL+"/download/"+t+"?session_id="+this.sessionId();window.location.href=e},deleteFile:function(i,s){var n="file"==s?"remove_files":"remove_directory";i=i.replace(/\/+$/,"");var a=i.match(/(.+)\/[^/]+$/),o="/";a!=e&&a.length>1&&(o=a[1]);var r=this,l=i.replace(this.options.root,""),d=t("<div></div>").kbaseDeletePrompt({name:l,callback:function(t,e){e.closePrompt(),r.client()[n](r.sessionId(),"/",i,function(){r.refreshDirectory(o)})}});d.openPrompt()},addDirectory:function(e){var i=this,s=e.replace(this.options.root,"/"),n=t("<div></div>").kbasePrompt({title:"Create directory",body:t("<p></p>").append("Create directory ").append(t("<span></span>").css("font-weight","bold").text(s)).append(" ").append(t("<input></input>").attr("type","text").attr("name","dir_name").attr("size","20")),controls:["cancelButton",{name:"Create directory",type:"primary",callback:function(t,s){s.closePrompt(),i.client().make_directory(i.sessionId(),e,n.dialogModal().find("input").val(),function(){i.refreshDirectory(e)},function(){})}}]});n.openPrompt()}})}(jQuery),function(t){t.KBWidget("kbaseIrisFileEditor","kbaseAuthenticatedWidget",{version:"1.0.0",_accessors:["client",{name:"file",setter:"setFile"},"rows","cols","content","loadedContent","saveFileCallback","cancelSaveFileCallback"],options:{rows:50,cols:85},init:function(t){return this._super(t),this.appendUI(this.$elem),this},setFile:function(t){this.setValueForKey("file",t),this.appendUI(this.$elem)},save:function(){var t=this.file().split("/"),e=t.pop(),i=t.join("/");this.content()!=this.loadedContent()&&this.client().put_file(this.sessionId(),e,this.content(),i,jQuery.proxy(function(){this.dbg("saved file")},this),jQuery.proxy(function(t){throw"Could not save file "+t.error.message},this))},appendUI:function(e){e.empty(),e.append("Loading file "+this.file()+"...<br>please wait...").append(t.jqElem("br")).append(t.jqElem("div").attr("align","center").append(t.jqElem("i").addClass("icon-spinner").addClass("icon-spin icon-4x"))),this.client().get_file(this.sessionId(),this.file(),"/",t.proxy(function(i){var s=t.jqElem("textarea").attr("rows",this.rows()).attr("cols",this.cols()).css("width","720px").kb_bind(this,"content");this.content(i),this.loadedContent(this.content()),e.empty(),e.append(s)},this),function(t){this.dbg("FILE FAILURE"),this.dbg(t)})},savePrompt:function(){if(this.content()==this.loadedContent())return this.saveFileCallback&&this.saveFileCallback()(this.file()),void 0;var e=t.jqElem("div").kbasePrompt({title:"Save changes",body:"Save changes to <strong>"+this.file()+"</strong> before closing?",controls:[{name:"Close without save",callback:t.proxy(function(t,e){e.closePrompt(),this.cancelSaveFileCallback&&this.cancelSaveFileCallback()(this.file())},this)},{name:"Close and save",type:"primary",callback:t.proxy(function(t,e){e.closePrompt(),this.save(),this.saveFileCallback&&this.saveFileCallback()(this.file())},this)}]});e.openPrompt()}})}(jQuery),function(t,e){t.KBWidget("kbaseIrisGrammar","kbaseWidget",{version:"1.0.0",options:{defaultGrammarURL:"http://www.prototypesite.net/iris-dev/grammar.json"},init:function(i){return this._super(i),this.options.$loginbox!=e&&(this.$loginbox=this.options.$loginbox),this.appendUI(t(this.$elem)),this.retrieveGrammar(this.options.defaultGrammarURL),this},appendUI:function(){},tokenize:function(t){for(var i=[],s="",n=e,a=!1,o=0;o<t.length;o++){var r=t.charAt(o);n==e&&r.match(/[?;]/)||(r.match(/\S/)||n!=e?(s+=r,n==e||r!=n||a?(n==e&&('"'==r||"'"==r)&&(n=r),a="\\"==r?!0:!1):(s=s.substring(1,s.length-1),i.push(s),s="",n=e)):s.length&&(i.push(s),s=""))}return s.length&&i.push(s),i},evaluate:function(i,s){var n=this.tokenize(i),a=this.grammar;if(a==e)return this.retrieveGrammar(this.options.defaultGrammarURL,t.proxy(function(){this.evaluate(i,s)},this)),void 0;var o={},r={parsed:"",string:i,grammar:a._root};"explain"==n[0]&&(n.shift(),r.explain=1);for(var l=0;l<n.length;l++){var d=n[l],c=!1;for(child in r.grammar.children){var p=r.grammar.children[child];if(p.regex&&d.match(p.regex))r.grammar=r.grammar.children[child],c=!0;else if(child.match(/^\$/))r.grammar=r.grammar.children[child],c=!0;else if(d==child)r.grammar=r.grammar.children[child],c=!0;else if(!p.caseSensitive){var h=new RegExp("^"+child+"$","i");d.match(h)&&(r.grammar=r.grammar.children[child],c=!0)}if(c){child.match(/^\$/)&&(o[child]=d),r.parsed=r.parsed.length?r.parsed+" "+d:d,r.grammar=p,r.execute=p.execute;break}}if(!c&&!r.grammar.childrenOptional){r.tail=n.splice(l,n.length-l).join(" ");break}}if(r.grammar.children!=e&&Object.keys(r.grammar.children).length&&!r.grammar.childrenOptional){r.error="Parse error at "+d,r.fail=1,delete r.execute,r.token=d,r.tail=n.splice(l,n.length-l).join(" ");var u=[];if(r.grammar.children!=e)for(prop in r.grammar.children)u.push(this.nextForGrammar(prop,r.grammar.children));return r.next=u.sort(),s&&s(r),r}r.rawExecute=r.execute;for(var f in o)r.execute=r.execute.replace(f,o[f]);if(r.tail){var g;(g=r.tail.match(/^into\s+(\S+)/))?r.execute=r.execute+" > "+g[1]:(r.fail=1,r.error="Extra characters - "+r.tail)}return s&&s(r),r},nextForGrammar:function(t,i){t==e&&(t="");for(var s=i[t].children,n=1e3;s!=e&&n-->0;)if(1==Object.keys(s).length){var a=Object.keys(s)[0];t=t.length?t+" "+a:a,s=s[a].children}return t},allQuestions:function(t){var i=["Display the dna sequence of contig $contig_id from $max to $min","Display the dna sequence of gene $gene_id","What type of family is $family","What is the function of family $family","What fids are in family $family","Display sequences in family $family as fasta","Display sequences in family $family","What is the function of feature $feature_id","What fids in k12 have attached publications","What publications have been connected to gene thrB","Show the DNA sequence of fid thrB","Display the protein sequence of fid thrB","Which protein families contain gene $gene_id","Is fid thrB in an atomic regulon","Which fids appear to have correlated expression with gene thrB","What is the location of feature thrB","What protein sequence corresponds to fid $fid","Which contigs are in genome $genome","What is the size of genome $genome","What is the KBase id of SEED genome $genome","What is the KBase id of SEED feature $feature","What is the source of genome $genome","Which are the closest genomes to $genome","What is the name of genome $genome","Which genomes have models","Which models exist for genome $genome","Which reactions exist in genome $genome","Which reactions are in model $model","What reactions connect to role $role","What roles relate to reaction $reaction","What complexes implement reaction $reaction","What reactions does complex $complex implement","Describe the biomass reaction for model kb|fm.0","What compounds are connected to model $model","What media are known","What compounds are considered part of media $media","show reactions that connect to compound $compound","How many otus exist","What otus exist","What otu contains $otu","What genomes are in OTU $otu","What annotations are known for protein sequence $sequence","What roles are used in models","What roles are used in subsystem $subsystem","What subsystems include role $role","What features in $feature implement role $role","What families implement role $role","What roles occur in subsystem $subsystem","What roles are in subsystem $subsystem","What genomes are in subsystem $subsystem","What subsystems are in genome $genome","what is the taxonomy of genome $genome","What is the taxonomic group id of $group_id","What genomes are in taxonomic group $group"];if(t==e)return i;for(var s=[],n=new RegExp(t),a=0;a<i.length;a++){var o=i[a];o.match(n)&&s.push(o)}return s},XXXallQuestionsBOGUS:function(i,s){if(s==e&&(s=""),i==e){if(this.grammar==e)return this.retrieveGrammar(this.options.defaultGrammarURL,t.proxy(function(){this.allQuestions()},this)),void 0;i=this.grammar._root.children}for(var n in i)s.length?s+" "+n:n},retrieveGrammar:function(i,s){var n=e;t.ajax({async:!0,dataType:"text",url:i,crossDomain:!0,beforeSend:function(t){n&&t.setRequestHeader("Authorization",n)},success:t.proxy(function(t){var e=JSON.parse(t);this.grammar=e,s&&s()},this),error:t.proxy(function(t,e){throw this.dbg(e),t},this),type:"GET"})}})}(jQuery),function(t,e){t.KBWidget("kbaseIrisProcessList","kbaseWidget",{version:"1.0.0",_accessors:["processList"],options:{processList:{}},init:function(e){return this._super(e),t(document).on("updateIrisProcess.kbaseIris",t.proxy(function(t,e){this.updateProcess(t,e)},this)),t(document).on("removeIrisProcess.kbaseIris",t.proxy(function(t,e){this.removeProcess(t,e)},this)),this.appendUI(this.$elem),this},updateProcess:function(i,s){var n=s.pid;if(n==e)throw"Cannot update process w/o pid";this.pendingLi().remove();var a=this.processList()[n]!=e?this.processList()[n]:t.jqElem("li");return a.empty(),s.msg?a.text(s.msg):s.content&&a.append(s.content),this.processList()[n]==e&&(this.$elem.find("ul").append(a),this.processList()[n]=a),a},removeProcess:function(t,i){if(i==e)throw"Cannot update process w/o pid";var s=this.processList()[i];if(s!=e)return s.remove(),0==this.$elem.find("ul").children().length&&this.$elem.find("ul").append(this.pendingLi()),this.processList()[i]=e,i},appendUI:function(e){return e.kbaseBox({title:"Running processes",content:t("<ul></ul>").addClass("unstyled").append(this.pendingLi())}),this},pendingLi:function(){return this.data("pendingLi")==e&&this.data("pendingLi",t("<li></li>").css("font-style","italic").text("No processes running")),this.data("pendingLi")}})}(jQuery),function(t,e){t.KBWidget("kbaseIrisTerminal","kbaseAuthenticatedWidget",{version:"1.0.0",_accessors:["terminalHeight","client"],options:{invocationURL:"http://localhost:5000",searchURL:"https://kbase.us/services/search-api/search/$category/$keyword?start=$start&count=$count&format=json",searchStart:1,searchCount:10,searchFilter:{literature:"link,pid"},maxOutput:100,scrollSpeed:750,terminalHeight:"450px",promptIfUnauthenticated:1,autocreateFileBrowser:!0},init:function(i){return this._super(i),t.fn.setCursorPosition=function(e){return 0==this.length?this:t(this).setSelection(e,e)},t.fn.setSelection=function(t,e){if(0==this.length)return this;if(input=this[0],input.createTextRange){var i=input.createTextRange();i.collapse(!0),i.moveEnd("character",e),i.moveStart("character",t),i.select()}else input.setSelectionRange&&(input.focus(),input.setSelectionRange(t,e));return this},t.fn.focusEnd=function(){return this.setCursorPosition(this.val().length),this},t.fn.getCursorPosition=function(){return 0==this.length?this:(input=this[0],input.selectionEnd)},this.client()==e&&this.client(new InvocationService(this.options.invocationURL,e,t.proxy(function(){var t=this.auth()?this.auth().token:e;return t},this))),this.tutorial=t("<div></div>").kbaseIrisTutorial(),this.commandHistory=[],this.commandHistoryPosition=0,this.path=".",this.cwd="/",this.variables={},this.aliases={},this.appendUI(t(this.$elem)),this.fileBrowsers=[],this.options.fileBrowser?this.addFileBrowser(this.options.fileBrowser):this.options.autocreateFileBrowser&&this.addFileBrowser(t("<div></div>").kbaseIrisFileBrowser({client:this.client(),externalControls:!1})),this},loggedInCallback:function(e,i){i.success&&(this.client().start_session(i.user_id,t.proxy(function(){this.loadCommandHistory(),i.token?this.out("Authenticated as "+i.name):this.out("Unauthenticated logged in as "+i.kbase_sessionid),this.out_line(),this.scroll()},this),t.proxy(function(t){this.out("<i>Error on session_start:<br>"+t.error.message.replace("\n","<br>\n")+"</i>",0,1)},this)),this.input_box.focus())},loggedInQueryCallback:function(t){this.loggedInCallback(e,t),!t.success&&this.options.promptIfUnauthenticated&&this.trigger("promptForLogin")},loggedOutCallback:function(){this.cwd="/",this.commandHistory=e,this.terminal.empty()},addFileBrowser:function(t){this.fileBrowsers.push(t)},open_file:function(t){this.fileBrowsers[0].openFile(t)},refreshFileBrowser:function(){for(var t=0;t<this.fileBrowsers.length;t++)this.fileBrowsers[t].refreshDirectory(this.cwd)},appendInput:function(t,i){if(this.input_box){var s=i==e?" ":"";0==this.input_box.val().length&&(s=""),this.input_box.val(this.input_box.val()+s+t),this.input_box.focusEnd()}},appendUI:function(e){var i=t("<div></div>").append(t("<div></div>").attr("id","terminal").css("height",this.options.terminalHeight).css("overflow","auto").css("padding","5px").css("font-family","monospace")).append(t("<textarea></textarea>").attr("id","input_box").attr("style","width : 95%;").attr("height","3")).append(t("<div></div>").attr("id","file-uploader")).append(t("<div></div>").attr("id","panel").css("display","none"));this._rewireIds(i,this),e.append(i),this.terminal=this.data("terminal"),this.input_box=this.data("input_box"),this.out("Welcome to the interactive KBase terminal!<br>\nPlease click the 'Sign in' button in the upper right to get started.<br>\nType <b>commands</b> for a list of commands.<br>\nFor usage information about a specific command, type the command name with -h or --help after it.<br>\nPlease visit <a href = 'http://kbase.us/for-users/tutorials/navigating-iris/' target = '_blank'>http://kbase.us/for-users/tutorials/navigating-iris/</a> or type <b>tutorial</b> for an IRIS tutorial.<br>\nTo find out what's new, type <b>whatsnew</b><br>\n",0,1),this.out_line(),this.input_box.bind("keypress",jQuery.proxy(function(t){this.keypress(t)},this)),this.input_box.bind("keydown",jQuery.proxy(function(t){this.keydown(t)},this)),this.input_box.bind("onchange",jQuery.proxy(function(){this.dbg("change")},this)),this.data("input_box").focus(),t(window).bind("resize",jQuery.proxy(function(){this.resize_contents(this.terminal)},this)),this.resize_contents(this.terminal)},saveCommandHistory:function(){this.client().put_file(this.sessionId(),"history",JSON.stringify(this.commandHistory),"/",function(){},function(){})},loadCommandHistory:function(){this.client().get_file(this.sessionId(),"history","/",jQuery.proxy(function(t){this.commandHistory=JSON.parse(t),this.commandHistoryPosition=this.commandHistory.length},this),jQuery.proxy(function(t){this.dbg("error on history load : "),this.dbg(t)},this))},resize_contents:function(){},keypress:function(t){if(13==t.which){t.preventDefault();var e=this.input_box.val();e=e.replace(/^ +/,""),e=e.replace(/ +$/,""),this.dbg("Run ("+e+")"),this.out_cmd(e);var i,s=e+e;(i=e.match(/^\s*(\$\S+)/))&&(s=i[1]);for(variable in this.variables)if(!variable.match(s)){var n=variable.replace(/\$/,"\\$"),a=new RegExp(n,"g");e=e.replace(a,this.variables[variable])}this.run(e),this.scroll(),this.input_box.val("")}},keydown:function(t){if(38==t.which)t.preventDefault(),this.commandHistoryPosition>0&&this.commandHistoryPosition--,this.input_box.val(this.commandHistory[this.commandHistoryPosition]);else if(40==t.which)t.preventDefault(),this.commandHistoryPosition<this.commandHistory.length&&this.commandHistoryPosition++,this.input_box.val(this.commandHistory[this.commandHistoryPosition]);else if(39==t.which&&this.options.commandsElement){var i=this.input_box.val().length,s=this.input_box.getCursorPosition();if(s!=e&&i>s)return this.selectNextInputVariable(t),void 0;t.preventDefault();var n=this.input_box.val().match(/([^\s]+)\s*$/);if(n.length){n=n[1];var a=this.options.grammar.evaluate(this.input_box.val());if(a!=e&&a.next&&a.next.length){for(var o=new RegExp("^"+n),r=[],l=0;l<a.next.length;l++){var d=a.next[l];d.match(o)&&r.push(d)}if((r.length||0==a.parsed.length)&&(a.next=r,1==a.next.length)){var c=new RegExp("s*"+n+"s*$");this.input_box.val(this.input_box.val().replace(c,""))}if(1==a.next.length){var p=" ";return this.input_box.val().match(/\s+$/)&&(p=""),this.appendInput(p+a.next[0]+" ",0),this.selectNextInputVariable(),void 0}if(a.next.length){var h=!0,u=new RegExp(n+"\\s*$");for(prop in a.next)prop.match(u)||(h=!1);return this.displayCompletions(a.next,n),void 0}}var f=this.options.commandsElement.kbaseIrisCommands("completeCommand",n);if(1==f.length){var g=f[0].replace(new RegExp("^"+n),"");this.appendInput(g+" ",0)}else f.length&&this.displayCompletions(f,n)}}},selectNextInputVariable:function(t){var i;if(this.input_box.getCursorPosition(),i=this.input_box.val().match(/(\$\S+)/)){t!=e&&t.preventDefault();var s=this.input_box.val().indexOf(i[1]),n=this.input_box.val().indexOf(i[1])+i[1].length;this.input_box.setSelection(s,n),this.input_box.setSelection(s,n)}},search_json_to_table:function(e,i){var s=t("<div></div>"),n=new RegExp(".");return i&&(n=new RegExp(i.replace(/,/g,"|"))),t.each(e,t.proxy(function(e,i){for(var a=t("<table></table>").css("border","1px solid black").css("margin-bottom","2px"),o=Object.keys(i).sort(),e=0;e<o.length;e++){var r=o[e];r.match(n)&&a.append(t("<tr></tr>").css("text-align","left").append(t("<th></th>").append(r)).append(t("<td></td>").append(i[r])))}s.append(a)},this)),s},displayCompletions:function(i,s){var n=this.options.commandsElement.kbaseIrisCommands("commonCommandPrefix",i);n!=e&&n.length?this.input_box.val(this.input_box.val().replace(new RegExp(s+"s*$"),n)):n=s;var a=t("<div></div>");this.terminal.append(a);var o=t("<table></table>").attr("border",1).css("margin-top","10px").append(t("<tr></tr>").append(t("<th></th>").text("Suggested commands")));jQuery.each(i,jQuery.proxy(function(e,i){o.append(t("<tr></tr>").append(t("<td></td>").append(t("<a></a>").attr("href","#").text(i).bind("click",jQuery.proxy(function(t){t.preventDefault(),this.input_box.val(this.input_box.val().replace(new RegExp(n+"s*$"),"")),this.appendInput(i+" ")},this)))))},this)),a.append(o),this.scroll()},out_cmd:function(e){var i=t("<div></div>").css("white-space","pre").css("position","relative").append(t("<span></span>").addClass("command").text(">"+this.cwd+" "+e)).mouseover(function(){t(this).children().first().show()}).mouseout(function(){t(this).children().first().hide()});i.kbaseButtonControls({controls:[{icon:"icon-eye-open",callback:function(){var e=window.open();e.document.open();var i=t("<div></div>").append(t("<div></div>").css("white-space","pre").css("font-family","monospace").append(t(this).parent().parent().next().clone()));t.each(i.find("a"),function(e,i){t(i).replaceWith(t(i).html())}),e.document.write(i.html()),e.document.close()}},{icon:"icon-remove",callback:function(){t(this).parent().parent().next().remove(),t(this).parent().parent().next().remove(),t(this).parent().parent().remove()}}]}),this.terminal.append(i)},out:function(t,e,i){this.out_to_div(this.terminal,t,e,i)},out_to_div:function(t,e,i,s){s||"string"!=typeof e||(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")),t.append(e),i&&this.scroll(0)},out_line:function(){var e=t("<hr/>");this.terminal.append(e),this.scroll(0)},scroll:function(t){t==e&&(t=this.options.scrollSpeed),this.terminal.animate({scrollTop:this.terminal.prop("scrollHeight")-this.terminal.height()},t)},cleanUp:function(t){setTimeout(function(){var e=5e3;setTimeout(function(){t.prev().fadeOut(500,function(){t.prev().remove()})},e),setTimeout(function(){t.next().fadeOut(500,function(){t.next().remove()})},e),setTimeout(function(){t.fadeOut(500,function(){t.remove()})},e)},1e3)},run:function(i){if("help"==i)return this.out('There is an introductory Iris tutorial available <a target="_blank" href="http://kbase.us/developer-zone/tutorials/iris/introduction-to-the-kbase-iris-interface/">on the KBase tutorials website</a>.',0,1),void 0;var s=t("<div></div>").css("white-space","pre");this.terminal.append(s),this.out_line();var n;if(n=i.match(/^log[io]n\s*(.*)/)){var a=n[1].split(/\s+/);return this.dbg(a.length),1!=a.length?(this.out_to_div(s,"Invalid login syntax."),void 0):(sid=a[0],this.client().start_session(sid,jQuery.proxy(function(){var t={kbase_sessionid:sid,success:!0};this.terminal.empty(),this.trigger("logout",!1),this.trigger("loggedIn",t)},this),jQuery.proxy(function(t){this.out_to_div(s,"<i>Error on session_start:<br>"+t.error.message.replace("\n","<br>\n")+"</i>",0,1)},this)),this.scroll(),void 0)}if(n=i.match(/^authenticate\s*(.*)/)){var a=n[1].split(/\s+/);return 1!=a.length?(this.out_to_div(s,"Invalid login syntax."),void 0):(sid=a[0],this.trigger("promptForLogin",{user_id:sid}),void 0)}if(n=i.match(/^unauthenticate/))return this.trigger("logout"),this.scroll(),void 0;if(n=i.match(/^logout/))return this.trigger("logout",!1),this.scroll(),void 0;if(!this.sessionId())return this.out_to_div(s,"You are not logged in."),this.scroll(),void 0;if(this.commandHistory.push(i),this.saveCommandHistory(),this.commandHistoryPosition=this.commandHistory.length,"clear"==i)return this.terminal.empty(),void 0;if("history"==i){var o={structure:{header:[],rows:[]},sortable:!0};jQuery.each(this.commandHistory,jQuery.proxy(function(e,i){o.structure.rows.push([e,{value:t("<a></a>").attr("href","#").text(i).bind("click",jQuery.proxy(function(t){t.preventDefault(),this.appendInput(i+" ")},this)),style:"padding-left : 10px"}])},this));var r=t.jqElem("div").kbaseTable(o);return this.out_to_div(s,r.$elem),void 0}if((n=i.match(/^!(\d+)/))&&(i=this.commandHistory.item(n[1])),n=i.match(/^cd\s*(.*)/)){var a=n[1].split(/\s+/);return 1!=a.length?(this.out_to_div(s,"Invalid cd syntax."),void 0):(dir=a[0],this.client().change_directory(this.sessionId(),this.cwd,dir,jQuery.proxy(function(t){this.cwd=t},this),jQuery.proxy(function(t){var e=t.error.message.replace("/\n","<br>\n");this.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(s)},this)),void 0)}if(n=i.match(/^(\$\S+)\s*=\s*(\S+)/))return this.variables[n[1]]=n[2],this.out_to_div(s,n[1]+" set to "+n[2]),void 0;if(n=i.match(/^alias\s+(\S+)\s*=\s*(\S+)/))return this.aliases[n[1]]=n[2],this.out_to_div(s,n[1]+" set to "+n[2]),void 0;if(n=i.match(/^upload\s*(\S+)?$/)){var l=n[1];if(this.fileBrowsers.length){var c=this.fileBrowsers[0];l&&c.data("override_filename",l),c.data("active_directory",this.cwd),c.uploadFile()}}else{if(n=i.match(/^#\s*(.+)/))return s.prev().remove(),this.out_to_div(s,t("<i></i>").text(n[1])),void 0;if(n=i.match(/^whatsnew/))return s.css("white-space",""),t.ajax({async:!0,dataType:"text",url:"whatsnew.html",crossDomain:!0,success:t.proxy(function(t){s.append(t),this.scroll()},this),error:t.proxy(function(t){s.append(t.responseText),this.scroll()},this),type:"GET"}),void 0;if(n=i.match(/^view\s+(\S+)$/)){var l=n[1];return this.client().get_file(this.sessionId(),l,this.cwd).done(t.proxy(function(e){if(l.match(/\.(jpg|gif|png)$/)){var i=t.jqElem("img").attr("src","data:image/jpeg;base64,"+btoa(e));s.append(i)}else s.append(e);this.scroll()},this)).fail(t.proxy(function(){s.append(t.jqElem("i").text("No such file")),this.cleanUp(s)},this)),void 0}if(n=i.match(/^search\s+(\S+)\s+(\S+)(?:\s*(\S+)\s+(\S+)(?:\s*(\S+))?)?/)){var p=this.options.grammar.evaluate(i),h={},u=this.options.searchURL;h.$category=n[1],h.$keyword=n[2],h.$start=n[3]||this.options.searchStart,h.$count=n[4]||this.options.searchCount;var f=n[5]||this.options.searchFilter[h.$category];for(prop in h)u=u.replace(prop,h[prop]);return t.support.cors=!0,t.ajax({type:"GET",url:u,dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},xhrFields:{withCredentials:!0},beforeSend:function(t){t.withCredentials=!0},success:t.proxy(function(e){this.out_to_div(s,t("<br>")),this.out_to_div(s,t("<i></i>").html("Command completed.")),this.out_to_div(s,t("<br>")),this.out_to_div(s,t("<span></span>").append(t("<b></b>").html(e.found)).append(" records found.")),this.out_to_div(s,t("<br>")),this.out_to_div(s,this.search_json_to_table(e.body,f)),this.search_json_to_table(e.body,f),this.scroll()},this),error:t.proxy(function(t,e,i){this.out_to_div(s,i)},this)}),void 0}if(n=i.match(/^cp\s*(.*)/)){var a=n[1].split(/\s+/);return 2!=a.length?(this.out_to_div(s,"Invalid cp syntax."),void 0):(from=a[0],to=a[1],this.client().copy(this.sessionId(),this.cwd,from,to,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(s)},this)),void 0)}if(n=i.match(/^mv\s*(.*)/)){var a=n[1].split(/\s+/);return 2!=a.length?(this.out_to_div(s,"Invalid mv syntax."),void 0):(from=a[0],to=a[1],this.client().rename_file(this.sessionId(),this.cwd,from,to,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(s)},this)),void 0)}if(n=i.match(/^mkdir\s*(.*)/)){var a=n[1].split(/\s+/);return a.length<1?(this.out_to_div(s,"Invalid mkdir syntax."),void 0):(t.each(a,t.proxy(function(e,i){this.client().make_directory(this.sessionId(),this.cwd,i,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(s)},this))},this)),void 0)}if(n=i.match(/^rmdir\s*(.*)/)){var a=n[1].split(/\s+/);return a.length<1?(this.out_to_div(s,"Invalid rmdir syntax."),void 0):(t.each(a,t.proxy(function(e,i){this.client().remove_directory(this.sessionId(),this.cwd,i,t.proxy(function(){this.refreshFileBrowser()},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(s)},this))},this)),void 0)}if(n=i.match(/^rm\s*(.*)/)){var a=n[1].split(/\s+/);return a.length<1?(this.out_to_div(s,"Invalid rm syntax."),void 0):(t.each(a,t.proxy(function(e,i){this.client().remove_files(this.sessionId(),this.cwd,i,t.proxy(function(){this.refreshFileBrowser()
},this),jQuery.proxy(function(t){var e=t.error.message.replace("\n","<br>\n");this.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),this.cleanUp(s)},this))},this)),void 0)}if("next"==i&&(this.tutorial.goToNextPage(),i="show_tutorial"),"back"==i&&(this.tutorial.goToPrevPage(),i="show_tutorial"),"tutorial"==i&&(this.tutorial.currentPage=0,i="show_tutorial"),"tutorial list"==i){var g=this.tutorial.list();return 0==g.length?(this.out_to_div(s,"Could not load tutorials"),this.out_to_div(s,"Type <i>tutorial list</i> to see available tutorials."),void 0):(t.each(g,t.proxy(function(e,i){s.append(t("<a></a>").attr("href","#").append(i.title).bind("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.out_to_div(s,"Set tutorial to <i>"+i.title+"</i><br>",0,1),this.tutorial.retrieveTutorial(i.url),this.input_box.focus()},this)).append("<br>"))},this)),this.scroll(),void 0)}if("show_tutorial"==i){var m=this.tutorial.contentForCurrentPage();if(m==e)return this.out_to_div(s,"Could not load tutorial"),void 0;m=m.clone();var v={"text-align":"left","font-size":"100%"};return m.find("h1").css(v),m.find("h2").css(v),this.tutorial.currentPage>0&&m.append("<br>Type <i>back</i> to move to the previous step in the tutorial."),this.tutorial.currentPage<this.tutorial.pages.length-1&&m.append("<br>Type <i>next</i> to move to the next step in the tutorial."),m.append("<br>Type <i>tutorial list</i> to see available tutorials."),s.css("white-space",""),this.out_to_div(s,m,0,1),this.scroll(),void 0}if("commands"==i)return this.client().valid_commands(jQuery.proxy(function(i){var n={structure:{header:[],rows:[]},sortable:!0,hover:!1};jQuery.each(i,function(t,i){n.structure.rows.push([{value:i.title,colspan:2,style:"font-weight : bold; text-align : center"}]);for(var s=0;s<i.items.length;s+=2)n.structure.rows.push([i.items[s].cmd,i.items[s+1]!=e?i.items[s+1].cmd:""])});var a=t.jqElem("div").kbaseTable(n);s.append(a.$elem),this.scroll()},this)),void 0;if(n=i.match(/^questions\s*(\S+)?/)){var b=this.options.grammar.allQuestions(n[1]),o={structure:{header:[],rows:[]},sortable:!0};t.each(b,t.proxy(function(e,i){o.structure.rows.push([{value:t.jqElem("a").attr("href","#").text(i).bind("click",jQuery.proxy(function(t){t.preventDefault(),this.input_box.val(i),this.selectNextInputVariable()},this))}])},this));var r=t.jqElem("div").kbaseTable(o);return s.append(r.$elem),this.scroll(),void 0}if(d=i.match(/^ls\s*(.*)/)){var a=d[1].split(/\s+/),y=this;if(0==a.length)d=".";else{if(1!=a.length)return this.out_to_div(s,"Invalid ls syntax."),void 0;d=a[0]}return this.client().list_files(this.sessionId(),this.cwd,d,jQuery.proxy(function(e){var i=e[0],n=e[1],a=[];t.each(i,function(t,e){a.push({size:"(directory)",mod_date:e.mod_date,name:e.name,nameTD:e.name})}),t.each(n,t.proxy(function(e,i){a.push({size:i.size,mod_date:i.mod_date,name:i.name,nameTD:t("<a></a>").text(i.name).attr("href","#").bind("click",jQuery.proxy(function(t){t.preventDefault(),this.open_file(i.full_path)},this)),url:this.options.invocationURL+"/download/"+i.full_path+"?session_id="+this.sessionId()})},this));var o={structure:{header:[],rows:[]},sortable:!0,bordered:!1};t.each(a.sort(this.sortByKey("name","insensitively")),t.proxy(function(t,e){o.structure.rows.push([e.size,e.mod_date,{value:e.nameTD}])},this));var r=t.jqElem("div").kbaseTable(o);s.append(r.$elem),this.scroll()},this),function(t){var e=t.error.message.replace("\n","<br>\n");y.out_to_div(s,"<i>Error received:<br>"+t.error.code+"<br>"+e+"</i>",0,1),y.cleanUp(s)}),void 0}var p=this.options.grammar.evaluate(i);if(p!=e)if(!p.fail&&p.execute){if(i=p.execute,p.explain)return s.append(p.execute),void 0}else if(p.parsed.length&&p.fail)return s.append(t("<i></i>").html(p.error)),void 0;var k=this.uuid(),x=t("<div></div>").text(i);x.kbaseButtonControls({onMouseover:!0,context:this,controls:[{icon:"icon-ban-circle",callback:function(t,e){s.prev().remove(),s.next().remove(),s.remove(),e.trigger("removeIrisProcess",k)}}]}),this.trigger("updateIrisProcess",{pid:k,content:x}),this.client().run_pipeline(this.sessionId(),i,[],this.options.maxOutput,this.cwd,jQuery.proxy(function(e){if(this.trigger("removeIrisProcess",k),e){var i=e[0],n=e[1];if(this.refreshFileBrowser(),i.length>0&&i[0].indexOf("	")>=0){var a=t("<table></table>");jQuery.each(i,jQuery.proxy(function(e,i){var s=i.split(/\t/),n=t("<tr></tr>");jQuery.each(s,jQuery.proxy(function(e,i){n.append(t("<td></td>").html(i)),e>0&&n.children().last().css("padding-left","15px"),e<s.length-1&&n.children().last().css("padding-right","15px")},this)),a.append(n)},this)),s.append(a)}else jQuery.each(i,jQuery.proxy(function(t,e){this.out_to_div(s,e,0)},this));n.length?(jQuery.each(n,jQuery.proxy(function(e,i){this.out_to_div(s,t("<i></i>").html(i))},this)),1==n.length&&n[0].match(/^Output truncated/)||this.cleanUp(s)):this.out_to_div(s,t("<i></i>").html("<br>Command completed."))}else this.out_to_div(s,"Error running command."),this.cleanUp(s);this.scroll()},this))}}})}(jQuery),function(t,e){t.KBWidget("kbaseIrisTutorial","kbaseWidget",{version:"1.0.0",options:{configURL:"http://www.prototypesite.net/kbase/tutorials.cfg"},format_tutorial_url:function(t,e,i){var s=t;return s=s.replace(/\$repo/,e),s=s.replace(/\$filespec/,i)},list:function(){var t=[];for(key in this.repos)for(var e=0;e<this.repos[key].length;e++){var i=this.repos[key][e],s=this.format_tutorial_url(this.doc_format_string,key,i.file);t.push({title:i.title,url:s})}return t.sort(this.sortByKey("title","insensitively"))},init:function(i){return this._super(i),this.pages=[],this.currentPage=-1,t.getJSON(this.options.configURL,t.proxy(function(t){this.repos=t.repos,this.doc_format_string=t.doc_format_string,this.options.tutorial==e&&(this.options.tutorial=t.default),this.options.tutorial&&this.retrieveTutorial(this.options.tutorial)},this)),this},retrieveTutorial:function(i){this.pages=[];var s=e;t.ajax({async:!0,dataType:"text",url:i,crossDomain:!0,beforeSend:function(t){s&&t.setRequestHeader("Authorization",s)},success:t.proxy(function(e){var i=t("<div></div>").append(e);t.each(i.children(),t.proxy(function(e,i){t(i).find(".example").remove(),this.pages.push(t(i))},this)),this.renderAsHTML()},this),error:t.proxy(function(t){throw this.dbg(t),t},this),type:"GET"})},renderAsHTML:function(){this.$elem.empty(),t.each(this.pages,t.proxy(function(t,e){this.$elem.append(e)},this))},lastPage:function(){return this.pages.length-1},currentPage:function(){return page=this.currentPage,this.currentPage<0&&(page=0),this.pages[page]},goToPrevPage:function(){var t=this.currentPage-1;return 0>t&&(t=0),this.currentPage=t,t},goToNextPage:function(){var t=this.currentPage+1;return t>=this.pages.length&&(t=this.pages.length-1),this.currentPage=t,t},contentForPage:function(){return 0==this.pages.length?e:this.pages[this.currentPage]},contentForCurrentPage:function(){return this.contentForPage(this.currentPage)}})}(jQuery),function(t,e){t.KBWidget("kbaseLogin","kbaseWidget",{version:"1.0.0",options:{style:"text",loginURL:"http://kbase.us/services/authorization/Sessions/Login",possibleFields:["verified","name","opt_in","kbase_sessionid","token","groups","user_id","email","system_admin"],fields:["name","kbase_sessionid","user_id","token"]},get_kbase_cookie:function(i){var s={},n=t.cookie("kbase_session");if(n==e)return i==e?s:e;for(var a=n.split("|"),o=0;o<a.length;o++){var r=a[o].split("=");r[1]=r[1].replace(/PIPESIGN/g,"|"),r[1]=r[1].replace(/EQUALSSIGN/g,"="),s[r[0]]=r[1]}return s.success=1,i==e?s:s[i]},sessionId:function(){return this.get_kbase_cookie("kbase_sessionid")},token:function(){return this.get_kbase_cookie("token")},init:function(e){this._super(e);var i=this.get_kbase_cookie();this.$elem.empty();var s="_"+this.options.style+"Style";return this.ui=this[s](),this.ui&&this.$elem.append(this.ui),i.user_id&&(this.registerLogin&&this.registerLogin(i),this.options.prior_login_callback&&this.options.prior_login_callback.call(this,i),this.data("_session",i),this.trigger("loggedIn",this.get_kbase_cookie())),t(document).on("loggedInQuery.kbase",t.proxy(function(t,e){var i=this.get_kbase_cookie();e&&e(i)},this)),t(document).on("promptForLogin.kbase",t.proxy(function(t,e){e.user_id&&this.data("passed_user_id",e.user_id),this.openDialog()},this)),t(document).on("logout.kbase",t.proxy(function(t,e){this.logout(e)},this)),this},registerLoginFunc:function(){return this.registerLogin},specificLogoutFunc:function(){return this.specificLogout},populateLoginInfo:function(t){t.success?(this.data("_session",t),this._error=e):(this.data("_session",{}),this._error=t.message)},session:function(t,i){this.data("_session")==e&&this.data("_session",{});var s=this.data("_session");return 2==arguments.length&&(s[t]=i),arguments.length>0?s[t]:s},error:function(t){return t&&(this._error=t),this._error},openDialog:function(){if(this.data("loginDialog")){var i=this.data("loginDialog");t("form",i.dialogModal()).get(0).reset(),i.dialogModal().data("user_id").val(this.session("user_id")||this.data("passed_user_id")||this.options.user_id),delete this.options.user_id,this.session("user_id",e),i.dialogModal().trigger("clearMessages"),this.data("loginDialog").openPrompt()}},_textStyle:function(){this._createLoginDialog(),this.$elem.css("padding","9px 15px 7px 10px");var e=t("<span></span>").append(t("<a></a>").attr("id","loginlink").attr("href","#").text("Sign In").bind("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.openDialog()},this))).append(t("<div></div>").addClass("btn-group").attr("id","userdisplay").css("display","none").append(t("<button></button>").addClass("btn").addClass("btn-mini").addClass("dropdown-toggle").append(t("<i></i>").addClass("icon-user")).append(t("<i></i>").addClass("icon-caret-down")).bind("click",function(e){e.preventDefault(),e.stopPropagation(),t(this).next().toggle()})).append(t("<ul></ul>").addClass("dropdown-menu").addClass("pull-right").css("padding","3px").attr("id","login-dropdown-menu").append(t("<li></li>").css("border-bottom","1px solid lightgray").css("white-space","nowrap").append(t("<span></span>").css("white-space","nowrap").append("Signed in as ").append(t("<a></a>").attr("id","loggedinuser_id").css("font-weight","bold").attr("href","https://gologin.kbase.us/account/UpdateProfile").attr("target","_blank").css("padding-right","0px").css("padding-left","0px")))).append(t("<li></li>").addClass("pull-right").append(t("<span></span>").append(t("<a></a>").css("padding-right","0px").css("padding-left","0px").append("Sign out")).bind("click",t.proxy(function(t){t.stopPropagation(),t.preventDefault(),this.data("login-dropdown-menu").hide(),this.logout()},this))))));return this._rewireIds(e,this),this.registerLogin=function(t){t.success?(this.data("loginlink").hide(),this.data("loggedinuser_id").text(t.name),this.data("userdisplay").show(),this.data("loginDialog").closePrompt()):this.data("loginDialog").dialogModal().trigger("error",t.message)},this.specificLogout=function(){this.data("userdisplay").hide(),this.data("loginlink").show()},e},_hiddenStyle:function(){return this._createLoginDialog(),this.registerLogin=function(t){t.success?this.data("loginDialog").closePrompt():this.data("loginDialog").dialogModal().trigger("error",t.message)},e},_slimStyle:function(){this.data("loginDialog",e);var i=t("<span></span>").addClass("form-inline").append(t("<span></span>").attr("id","entrance").append(t("<span></span>").addClass("input-prepend input-append").append(t("<span></span>").addClass("add-on").append("username: ").bind("click",function(){t(this).next().focus()})).append(t("<input/>").attr("type","text").attr("name","user_id").attr("id","user_id").attr("size","20").val(this.options.user_id)).append(t("<span></span>").addClass("add-on").append(" password: ").bind("click",function(){t(this).next().focus()})).append(t("<input/>").attr("type","password").attr("name","password").attr("id","password").attr("size","20")).append(t("<button></button>").attr("id","loginbutton").addClass("btn btn-primary").append(t("<i></i>").attr("id","loginicon").addClass("icon-lock"))))).append(t("<span></span>").attr("id","userdisplay").attr("style","display : none;").addClass("input-prepend").append(t("<span></span>").addClass("add-on").append("Logged in as ").append(t("<span></span>").attr("id","loggedinuser_id").attr("style","font-weight : bold").append("user_id\n"))).append(t("<button></button>").addClass("btn").attr("id","logoutbutton").append(t("<i></i>").attr("id","logouticon").addClass("icon-signout"))));return this._rewireIds(i,this),this.data("password").keypress(t.proxy(function(t){13==t.keyCode&&(this.data("loginbutton").trigger("click"),t.stopPropagation())},this)),this.registerLogin=function(e){if(this.data("loginicon").removeClass().addClass("icon-lock"),e.success)this.data("entrance").hide(),this.data("user_id").val(""),this.data("password").val(""),this.data("loggedinuser_id").text(e.name),this.data("userdisplay").show();else{var i=t("<div></div>").kbasePrompt({title:"Login failed",body:t("<div></div>").attr("class","alert alert-error").append(t("<div></div>").append(t("<div></div>").addClass("pull-left").append(t("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(t("<div></div>").append(t("<strong></strong>").append(e.message)))),controls:["okayButton"]});i.openPrompt()}},this.specificLogout=function(){this.data("userdisplay").hide(),this.data("entrance").show()},this.data("loginbutton").bind("click",t.proxy(function(){this.data("loginicon").removeClass().addClass("icon-refresh"),this.login(this.data("user_id").val(),this.data("password").val(),function(t){this.registerLogin(t),this.options.login_callback&&this.options.login_callback.call(this,t)})},this)),this.data("logoutbutton").bind("click",t.proxy(function(){this.logout(),this.data("user_id").focus()},this)),i},_microStyle:function(){var e=t("<span></span>").append(t("<button></button>").addClass("btn btn-primary").attr("id","loginbutton").append(t("<i></i>").attr("id","loginicon").addClass("icon-lock")));return this._rewireIds(e,this),this._createLoginDialog(),this.data("loginbutton").bind("click",t.proxy(function(){this.openDialog()},this)),this.registerLogin=function(e){e.success?(this.data("loginDialog").dialogModal().trigger("clearMessages"),this.data("loginDialog").closePrompt(),this.data("loginbutton").tooltip({title:"Logged in as "+e.name}),this.data("loginicon").removeClass().addClass("icon-user"),this.data("loginbutton").bind("click",t.proxy(function(){this.logout()},this))):this.data("loginDialog").dialogModal().trigger("error",e.message)},this.specificLogout=function(){this.data("loginbutton").tooltip("destroy"),this.data("loginicon").removeClass().addClass("icon-lock")},e},_buttonStyle:function(){var e=t("<div></div>").attr("style","width : 250px; border : 1px solid gray").append(t("<h4></h4>").attr("style","padding : 5px; margin-top : 0px; background-color : lightgray ").addClass("text-center").append("User\n")).append(t("<div></div>").attr("id","entrance").append(t("<p></p>").attr("style","text-align : center").append(t("<button></button>").attr("id","loginbutton").append("Login").addClass("btn btn-primary")))).append(t("<div></div>").attr("id","userdisplay").attr("style","display : none;").append(t("<p></p>").attr("style","text-align : center").append("Logged in as ").append(t("<span></span>").attr("id","loggedinuser_id").attr("style","font-weight : bold").append("user_id\n")).append(t("<button></button>").attr("id","logoutbutton").append("Logout\n").addClass("btn"))));return this._rewireIds(e,this),this._createLoginDialog(),this.data("loginbutton").bind("click",t.proxy(function(){this.openDialog()},this)),this.data("logoutbutton").bind("click",t.proxy(this.logout,this)),this.registerLogin=function(t){t.success?(this.data("loginDialog").dialogModal().trigger("clearMessages"),this.data("entrance").hide(),this.data("loggedinuser_id").text(t.name),this.data("userdisplay").show(),this.data("loginDialog").closePrompt()):this.data("loginDialog").dialogModal().trigger("error",t.message)},this.specificLogout=function(){this.data("userdisplay").hide(),this.data("entrance").show()},e},_createLoginDialog:function(){this.$elem;var e=t("<div></div").kbasePrompt({title:"Login to KBase",controls:["cancelButton",{name:"Login",type:"primary",id:"loginbutton",callback:t.proxy(function(){var t=this.data("loginDialog").dialogModal().data("user_id").val(),e=this.data("loginDialog").dialogModal().data("password").val();this.data("loginDialog").dialogModal().trigger("message",t),this.login(t,e,function(t){this.registerLogin&&this.registerLogin(t),this.options.login_callback&&this.options.login_callback.call(this,t)})},this)}],body:t("<p></p>").append(t("<form></form>").attr("name","form").attr("id","form").addClass("form-horizontal").append(t("<fieldset></fieldset>").append(t("<div></div>").attr("class","alert alert-error").attr("id","error").attr("style","display : none").append(t("<div></div>").append(t("<div></div>").addClass("pull-left").append(t("<i></i>").addClass("icon-warning-sign").attr("style","float: left; margin-right: .3em;"))).append(t("<div></div>").append(t("<strong></strong>").append("Error:\n")).append(t("<span></span>").attr("id","errormsg"))))).append(t("<div></div>").attr("class","alert alert-success").attr("id","pending").attr("style","display : none").append(t("<div></div>").append(t("<div></div>").append(t("<strong></strong>").append("Logging in as:\n")).append(t("<span></span>").attr("id","pendinguser"))))).append(t("<div></div>").attr("class","control-group").append(t("<label></label>").addClass("control-label").attr("for","user_id").css("margin-right","10px").append("Username:\n")).append(t("<input/>").attr("type","text").attr("name","user_id").attr("id","user_id").attr("size","20"))).append(t("<div></div>").attr("class","control-group").append(t("<label></label>").addClass("control-label").attr("for","password").css("margin-right","10px").append("Password:\n")).append(t("<input/>").attr("type","password").attr("name","password").attr("id","password").attr("size","20"))))),footer:t("<span></span").append(t("<a></a>").attr("href","https://gologin.kbase.us/ResetPassword").attr("target","_blank").text("Forgot password?")).append("&nbsp;|&nbsp;").append(t("<a></a>").attr("href"," https://gologin.kbase.us/OAuth?response_type=code&step=SignUp&redirect_uri="+encodeURIComponent(location.href)).attr("target","_blank").text("Sign up"))});return this._rewireIds(e.dialogModal(),e.dialogModal()),this.data("loginDialog",e),e.dialogModal().bind("error",function(e,i){t(this).trigger("clearMessages"),t(this).data("error").show(),t(this).data("errormsg").html(i)}),e.dialogModal().bind("message",function(e,i){t(this).trigger("clearMessages"),t(this).data("pending").show(),t(this).data("pendinguser").html(i)}),e.dialogModal().bind("clearMessages",function(){t(this).data("error").hide(),t(this).data("pending").hide()}),e.dialogModal().on("shown",function(){0==t(this).data("user_id").val().length?t(this).data("user_id").focus():t(this).data("password").focus()}),e},login:function(i,s,n){var a={user_id:i,status:1};0==i.length?(a.message="Cannot login w/o user_id",a.status=0,n.call(this,a)):s==e||0==s.length?(a.message="Cannot login w/o password",a.status=0,n!=e&&n.call(this,a)):(a.password=s,a.cookie=1,a.fields=this.options.fields.join(","),t.support.cors=!0,t.ajax({type:"POST",url:this.options.loginURL,data:a,dataType:"json",crossDomain:!0,xhrFields:{withCredentials:!0},success:t.proxy(function(e){if(e.kbase_sessionid){for(var i=[],s={success:1},a=this.options.fields,o=0;o<a.length;o++){var r=e[a[o]];s[a[o]]=r,r=r.replace(/=/g,"EQUALSSIGN"),r=r.replace(/\|/g,"PIPESIGN"),i.push(a[o]+"="+r)}t.cookie("kbase_session",i.join("|")),this.populateLoginInfo(s),this.trigger("loggedIn",this.get_kbase_cookie()),n.call(this,s)}else t.removeCookie("kbase_session"),this.populateLoginInfo({}),n.call(this,{status:0,message:e.error_msg}),this.trigger("loggedInFailure",{status:0,message:e.error_msg})},this),error:t.proxy(function(t,e){"error"==e&&(e="Error connecting to KBase login server"),this.populateLoginInfo({}),n.call(this,{status:0,message:e})},this),xhrFields:{withCredentials:!0},beforeSend:function(t){t.withCredentials=!0}}))},logout:function(i){i==e&&(i=!0);var s=this.get_kbase_cookie("kbase_sessionid");s!=e&&(t.removeCookie("kbase_session"),this.specificLogout&&this.specificLogout(),this.populateLoginInfo({}),this.data("loginDialog")!=e&&i&&this.openDialog(),this.trigger("loggedOut"),this.options.logout_callback&&this.options.logout_callback.call(this))}})}(jQuery),function(t,e){t.KBWidget("kbasePrompt","kbaseWidget",{version:"1.0.0",options:{controls:["cancelButton","okayButton"],modalClass:"fade"},init:function(t){return this._super(t),this},openPrompt:function(){this.dialogModal().modal({keyboard:!0})},closePrompt:function(){this.dialogModal().modal("hide")},cancelButton:function(){return{name:"Cancel",callback:function(t,e){e.closePrompt()}}},okayButton:function(){return{name:"Okay",type:"primary",callback:function(t,e){e.closePrompt()}}},dialogModal:function(){if(this.data("dialogModal")!=e)return this.data("dialogModal");var i=t("<div></div>").attr("class","modal hide "+this.options.modalClass).attr("tabindex","-1").append(t("<div></div>").attr("class","modal-header").append(t("<button></button>").attr("type","button").attr("class","close").attr("data-dismiss","modal").attr("aria-hidden","true").append("x\n")).append(t("<h3></h3>").attr("id","title"))).append(t("<div></div>").attr("class","modal-body").attr("id","body")).append(t("<div></div>").attr("class","modal-footer").append(t("<div></div>").addClass("row-fluid").addClass("form-horizontal").append(t("<div></div>").addClass("span6").addClass("text-left").attr("id","footer")).append(t("<div></div>").addClass("span6").attr("id","controls").css("white-space","nowrap"))));i.unbind("keypress"),i.keypress(function(e){13==e.keyCode&&(e.stopPropagation(),e.preventDefault(),t("a:last",i).trigger("click"))}),this._rewireIds(i,i),this.options.title&&i.data("title").append(this.options.title),this.options.body&&i.data("body").append(this.options.body),this.options.footer&&i.data("footer").append(this.options.footer);var s=this;t.each(this.options.controls,function(e,n){"string"==typeof n&&(n=s[n]());var a="btn";n.type&&(a=a+" btn-"+n.type);var o=t("<a></a>").attr("href","#").attr("class",a).append(n.name).bind("click",function(t){t.preventDefault(),t.stopPropagation(),n.callback.call(this,t,s)});n.id&&o.attr("id",n.id),i.data("controls").append(o)}),this._rewireIds(i,i),this.data("dialogModal",i);var n=e,a=!1;return i.on("shown",t.proxy(function(){t.each(i.find("input[type=text],input[type=password],textarea"),function(i,s){return n==e&&(n=t(s)),t(s).is("input")&&t(s).val()==e?(t(s).focus(),a=!0,void 0):t(s).is("textarea")&&0==t(s).text().length?(t(s).focus(),a=!0,void 0):void 0}),a||n==e||n.focus()},this)),i}})}(jQuery),function(t,e){t.KBWidget("kbaseTable","kbaseWidget",{version:"1.0.0",options:{sortable:!1,striped:!0,hover:!0,bordered:!0},init:function(e){return this._super(e),this.appendUI(t(this.$elem),this.options.structure),this},appendUI:function(i,s){i.empty();var n=t("<table></table>").attr("id","table").addClass("table");if(this.options.tblOptions&&this.addOptions(n,this.options.tblOptions),this.options.striped&&n.addClass("table-striped"),this.options.hover&&n.addClass("table-hover"),this.options.bordered&&n.addClass("table-bordered"),this.options.caption&&n.append(t("<caption></caption>").append(this.options.caption)),s.header){var a=t("<thead></thead>").attr("id","thead"),o=t("<tr></tr>").attr("id","headerRow");t.each(s.header,t.proxy(function(i,s){var n=this.nameOfHeader(s);new Date;var a=t("<th></th>").append(n);if("string"!=typeof s&&(this.addOptions(a,s),s.sortable)){var r=n+"-sortButton",l=t("<i></i>").addClass("icon-sort"),d=t("<button></button>").addClass("btn btn-mini").attr("id",r).css("display","none").css("float","right").append(l).data("shouldHide",!0);d.bind("click",t.proxy(function(){var t=this.data("lastSort");t!=e&&t.get(0)!=d.get(0)&&(t.children(":first").removeClass("icon-sort-up"),t.children(":first").removeClass("icon-sort-down"),t.children(":first").addClass("icon-sort"),t.data("shouldHide",!0),t.css("display","none")),l.hasClass("icon-sort")?(l.removeClass("icon-sort"),l.addClass("icon-sort-up"),d.data("shouldHide",!1),this.sortAndLayoutOn(n,1)):l.hasClass("icon-sort-up")?(l.removeClass("icon-sort-up"),l.addClass("icon-sort-down"),d.data("shouldHide",!1),this.sortAndLayoutOn(n,-1)):l.hasClass("icon-sort-down")&&(l.removeClass("icon-sort-down"),l.addClass("icon-sort"),d.data("shouldHide",!0),this.sortAndLayoutOn(e)),this.data("lastSort",d)},this)),a.append(d),a.bind("mouseover",t.proxy(function(){d.css("display","inline")},this)),a.bind("mouseout",t.proxy(function(){d.data("shouldHide")&&d.css("display","none")},this))}o.append(a)},this)),a.append(o),n.append(a)}if(s.rows){var r=this.data("tbody",t("<tbody></tbody>"));this.layoutRows(s.rows,s.header),n.append(r)}if(s.footer){for(var l=t("<tfoot></tfoot>").attr("id","tfoot"),d=0;d<s.footer.length;d++)l.append(t("<td></td>").append(s.footer[d]));n.append(l)}return this._rewireIds(n,this),i.append(n),i},sortAndLayoutOn:function(t,i){var s=this.options.structure.rows;if(t!=e){var n=this.nameOfHeader(t);s=this.options.structure.rows.slice().sort(function(t,e){var s=t[n],a=e[n];return s="string"==typeof s?s.toLowerCase():s,a="string"==typeof a?a.toLowerCase():a,a>s?0-i:s>a?i:0})}this.layoutRows(s,this.options.structure.header)},nameOfHeader:function(t){return"string"==typeof t?t:t.value},layoutRows:function(t,e){this.data("tbody").empty();for(var i=0;i<t.length;i++)this.data("tbody").append(this.createRow(t[i],e))},addOptions:function(i,s){if(s.style!=e&&i.attr("style",s.style),s.class!=e){var n="string"==typeof s.class?[s.class]:s.class;t.each(n,t.proxy(function(t,e){i.addClass(e)},this))}var a=["mouseover","mouseout","click"];t.each(a,t.proxy(function(t,n){s[n]!=e&&i.bind(n,s[n])},this)),s.colspan&&i.attr("colspan",s.colspan),s.rowspan&&i.attr("rowspan",s.rowspan)},createRow:function(i,s){var n=t("<tr></tr>");return t.isArray(i)?t.each(i,t.proxy(function(i,s){var a="string"==typeof s||"number"==typeof s?s:s.value,o=t.jqElem("td").append(a);"string"!=typeof s&&"number"!=typeof s&&this.addOptions(o,s),a!=e&&n.append(o)},this)):t.each(s,t.proxy(function(s,a){var o=this.nameOfHeader(a),r=t("<td></td>");if(i[o]!=e){var l="string"==typeof i[o]?i[o]:i[o].value;r.append(l),"string"!=typeof i[o]&&this.addOptions(r,i[o])}l!=e&&n.append(r)},this)),n},deletePrompt:function(e){var i=t("<div></div>").kbaseDeletePrompt({name:e,callback:this.deleteRowCallback(e)});i.openPrompt()},deleteRowCallback:function(){},shouldDeleteRow:function(){return 1}})}(jQuery),function(e,i){e.KBWidget("kbaseTabs","kbaseWidget",{version:"1.0.0",_accessors:["tabsHeight"],options:{tabPosition:"top",canDelete:!1,borderColor:"lightgray"},init:function(t){return this._super(t),this.data("tabs",{}),this.data("nav",{}),this.appendUI(e(this.$elem)),this},appendUI:function(t,s){s==i&&(s=this.options.tabs);var n=e("<div></div>").addClass("tabbable"),a=e("<div></div>").addClass("tab-content").attr("id","tabs-content").css("height",this.tabsHeight()),o=e("<ul></ul>").addClass("nav nav-tabs").attr("id","tabs-nav");"top"==this.options.tabPosition?(n.addClass("tabs-above"),n.append(o).append(a)):"bottom"==this.options.tabPosition?(n.addClass("tabs-below"),n.append(a).append(o)):"left"==this.options.tabPosition?(n.addClass("tabs-left"),n.append(o).append(a)):"right"==this.options.tabPosition&&(n.addClass("tabs-right"),n.append(a).append(o)),this._rewireIds(n,this),t.append(n),s&&e.each(s,e.proxy(function(t,e){this.addTab(e)},this))},addTab:function(s){s.canDelete==i&&(s.canDelete=this.options.canDelete);var n=e("<div></div>").addClass("tab-pane fade").append(s.content);this.options.border&&(n.css("border","solid "+this.options.borderColor),n.css("border-width","0px 1px 0px 1px"),n.css("padding","3px"));var a=this,o=e("<li></li>").css("white-space","nowrap").append(e("<a></a>").attr("href","#").text(s.tab).attr("data-tab",s.tab).bind("click",function(t){t.preventDefault(),t.stopPropagation();var i=a.data("tabs-nav").find(".active:last a")[0];e.fn.tab.Constructor.prototype.activate.call(e(this),e(this).parent("li"),a.data("tabs-nav")),e.fn.tab.Constructor.prototype.activate.call(e(this),n,n.parent(),function(){e(this).trigger({type:"shown",relatedTarget:i})})}).append(e("<button></button>").addClass("btn btn-mini").append(e("<i></i>").addClass(this.closeIcon())).css("padding","0px").css("width","22px").css("height","22px").css("margin-left","10px").attr("title",this.deleteTabToolTip(s.tab)).tooltip().bind("click",e.proxy(function(t){t.preventDefault(),t.stopPropagation(),s.deleteCallback!=i?s.deleteCallback(s.tab):this.deletePrompt(s.tab)},this))));s.canDelete||o.find("button").remove(),this.data("tabs")[s.tab]=n,this.data("nav")[s.tab]=o,this.data("tabs-content").append(n),this.data("tabs-nav").append(o);var r=0;for(t in this.data("tabs"))r++;(s.show||1==r)&&this.showTab(s.tab)},closeIcon:function(){return"icon-remove"},deleteTabToolTip:function(t){return"Remove "+t},hasTab:function(t){return this.data("tabs")[t]},showTab:function(t){this.shouldShowTab(t)&&this.data("nav")[t].find("a").trigger("click")},removeTab:function(t){var e=this.data("tabs")[t],s=this.data("nav")[t];s.hasClass("active")&&(s.next("li").length?s.next().find("a").trigger("click"):s.prev("li").find("a").trigger("click")),e.remove(),s.remove(),this.data("tabs")[t]=i,this.data("nav")[t]=i},shouldShowTab:function(){return 1},deletePrompt:function(t){var i=e("<div></div>").kbaseDeletePrompt({name:t,callback:this.deleteTabCallback(t)});i.openPrompt()},deleteTabCallback:function(t){return e.proxy(function(e,s){s!=i&&s.closePrompt(),this.shouldDeleteTab(t)&&this.removeTab(t)},this)},shouldDeleteTab:function(){return 1},activeTab:function(){var t=this.data("tabs-nav").find(".active:last a")[0];return e(t).attr("data-tab")}})}(jQuery),function(t,e){t.KBWidget("kbaseWorkspaceBrowser","kbaseFileBrowser",{version:"1.0.0",options:{name:"Workspace Browser",workspace:"chenrydemo",selectWorkspace:!0},init:function(t){return t.controlButtons=["deleteButton","viewButton","uploadButton","addButton"],this._super(t),this.options.wsClient!=e&&(this.wsClient=this.options.wsClient),this.options.workspace!=e&&(this.workspace=this.options.workspace),this.listWorkspaces(),this},token:function(){var t=this.$loginbox.get_kbase_cookie("token");return t},selected:function(){this.data("workspace-select").val();var t=this.data("workspace-select").find(":selected");"a"!=t.data("perm")&&this.deleteButton().addClass("disabled")},refreshDirectory:function(){this.listWorkspaces()},listDirectory:function(e,i){if(e==this.workspace)this.wsClient.list_workspace_objects_async({workspace:e,auth:this.token(),showDeletedObject:!1},t.proxy(function(e){var s=[];this.meta={},t.each(e,t.proxy(function(t,e){s.push({name:e[0],path:e[0],type:0==e[3]?"file":"directory"}),this.meta[e[0]]={name:e[0],version:e[3],type:e[1]}},this)),this.displayPath("/",i,s.sort(this.sortByName))},this));else if(this.workspace){for(var s=[],n=this.meta[e].version,a=n;a>=0;a--)s.push({name:"Revision "+a,path:e,type:"file",meta:{version:a}});this.displayPath("path",i,s)}},viewButton:function(){var i=this._super();return i.data("require","a"),i.unbind("click"),i.bind("click",t.proxy(function(t){if(t.preventDefault(),!this.viewButton().hasClass("disabled")){var i=this.data("activeFile");i==e&&(i=this.data("activeDirectory")),this.openFile(i)}},this)),i},addButton:function(){var i=this._super();return i.data("require","a"),i.unbind("click"),i.bind("click",t.proxy(function(t){if(t.preventDefault(),!this.addButton().hasClass("disabled")){var i=this.data("activeFile");i==e&&(i=this.data("activeDirectory")),this.options.addFileCallback(i)
}},this)),i},stringify:function(t,e){return"array"==typeof e?e=e.join(", "):"string"!=typeof e&&(e=this.stringify(e)),t+" : "+e},fetchContent:function(i,s){var n=this.$elem.find(".active"),a={type:this.meta[i].type,workspace:this.workspace,id:i};(meta=n.data("meta"))&&(a.instance=meta.version),this.wsClient.get_object_async(a,t.proxy(function(t){try{if("string"==typeof t.data)t=t.data;else{var n=JSON.stringify(t.data,e,2);t=n}}catch(a){this.dbg("FAILURE"),this.dbg(a),t=t.data}this.openFile(i,t,s)},this),t.proxy(function(e){s.close();var i=t("<div></div>").kbaseErrorPrompt({title:"Fetch failed",message:e.message});i.openPrompt()},this))},deleteFileCallback:function(i){this.workspace==e||this.wsClient.delete_object_async({type:"Unspecified",workspace:this.workspace,id:i,auth:this.token()},t.proxy(function(){this.listDirectory(this.workspace,this.data("ul-nav"))},this),t.proxy(function(e){var i=t("<div></div>").kbaseErrorPrompt({title:"Deletion failed",message:e.message});i.openPrompt()},this))},uploadFile:function(i,s,n,a){this.workspace==e||this.wsClient.save_object_async({type:"Unspecified",workspace:this.workspace,id:i,data:s,auth:this.token()},t.proxy(function(){this.options.processList&&this.options.processList.removeProcess(a),this.listDirectory(this.workspace,this.data("ul-nav"))},this),t.proxy(function(e){this.options.processList&&this.options.processList.removeProcess(a);var i=t("<div></div>").kbaseErrorPrompt({title:"Creation failed",message:e.message});i.openPrompt()},this))},createWorkspace:function(){var e=t("<div></div>").kbasePrompt({title:"Create workspace",body:t("<p></p>").append("Create workspace ").append(" ").append(t("<input></input>").attr("type","text").attr("name","ws_name").attr("size","20")),controls:["cancelButton",{name:"Create workspace",type:"primary",callback:t.proxy(function(i,s){s.closePrompt(),this.wsClient.create_workspace_async({workspace:e.dialogModal().find("input").val(),permission:"a",auth:this.token()},t.proxy(function(){this.workspace=e.dialogModal().find("input").val(),this.listWorkspaces()},this),t.proxy(function(e){var i=t("<div></div>").kbaseErrorPrompt({title:"Creation failed",message:e.message});i.openPrompt()},this))},this)}]});e.openPrompt()},deleteWorkspace:function(){var e=t("<div></div>").kbaseDeletePrompt({name:this.data("workspace-select").val(),callback:t.proxy(function(t,e){e.closePrompt(),this.deleteWorkspaceCallback(this.data("workspace-select").val())},this)});e.openPrompt()},deleteWorkspaceCallback:function(e){this.wsClient.delete_workspace_async({workspace:e,auth:this.token()},t.proxy(function(){this.listWorkspaces()},this),t.proxy(function(e){var i=t("<div></div>").kbaseErrorPrompt({title:"deletion failed",message:e.message});i.openPrompt()},this))},fileBrowserContainer:function(){var i=this._super("fileBrowserContainer");return this.options.selectWorkspace&&i.prepend(t("<div></div>").addClass("btn-toolbar").addClass("text-left").css("width","100%").append(t("<div></div>").addClass("input-append").attr("id","workspace-controls").append(t("<select></select>").css("height","22px").css("width","254px").attr("id","workspace-select").bind("change",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.workspace=e;var i=this.data("workspace-select").val(),s=this.data("workspace-select").find(":selected");"a"!=s.data("perm")?this.data("deleteWorkspace-button").addClass("disabled"):this.data("deleteWorkspace-button").removeClass("disabled"),"--- choose workspace ---"!=i&&(this.workspace=i,this.listDirectory(i,this.data("ul-nav")))},this))).append(t("<button></button>").addClass("btn btn-mini").attr("id","deleteWorkspace-button").append(t("<i></i>").addClass("icon-minus")).bind("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.data("deleteWorkspace-button").hasClass("disabled")||this.deleteWorkspace()},this))).append(t("<button></button>").addClass("btn btn-mini").attr("id","createWorkspace-button").append(t("<i></i>").addClass("icon-plus")).bind("click",t.proxy(function(t){t.preventDefault(),t.stopPropagation(),this.createWorkspace()},this))))),this._rewireIds(i,this),i},listWorkspaces:function(){this.wsClient.list_workspaces_async({auth:this.token()},t.proxy(function(i){var s=[];t.each(i,t.proxy(function(t,e){s.push({name:e[0],perm:e[4]})},this));var n;s=s.sort(this.sortByName),this.data("workspace-select")!=e&&(this.data("workspace-select").empty(),this.data("workspace-select").append(t("<option></option>").append(" --- choose workspace --- ").attr("val","")),t.each(s,t.proxy(function(e,i){var s=t("<option></option>").append(i.name).attr("value",i.name).data("perm",i.perm);i.name==this.workspace&&(n=i.perm),this.data("workspace-select").append(s)},this))),this.workspace&&(this.data("workspace-select").val(this.workspace),this.listDirectory(this.workspace,this.data("ul-nav"))),"a"!=n&&this.data("deleteWorkspace-button").addClass("disabled")},this))}})}(jQuery);